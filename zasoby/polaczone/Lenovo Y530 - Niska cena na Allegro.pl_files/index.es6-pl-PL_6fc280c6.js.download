const e="favorites";function t(e){function r(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((e=>({value:e,done:t})))}return t=function(e){this.s=e,this.n=e.next},t.prototype={s:null,n:null,next(){return r(this.n.apply(this.s,arguments))},return(e){var t=this.s.return;return void 0===t?Promise.resolve({value:e,done:!0}):r(t.apply(this.s,arguments))},throw(e){var t=this.s.return;return void 0===t?Promise.reject(e):r(t.apply(this.s,arguments))}},new t(e)}var r="prihlaseni",o="prihlasenie";const s="offers",i="queries",n="products",a="watchedQuery",d="watchedOffers",c="watchedProductQuery";let l=(e=>(e.FAVORITE_OFFER="favoriteOfferId",e.FAVORITE_QUERY="favoriteQueryId",e.FAVORITE_PRODUCT="favoriteProductId",e.WATCHED_QUERY="watchedQuery",e.WATCHED_PRODUCT_QUERY="watchedProductQuery",e))({});const u={[s]:"/watched/offers",[i]:"/web-edge/watched-queries",[n]:"/web-edge/watched-product-queries",[a]:"/web-edge/is-watched-query",[d]:"",[c]:"/web-edge/is-watched-product-query"},p={"allegro-pl":"logowanie","allegro-cz":r,"allegro-business-cz":r,"allegro-sk":o,"allegro-business-sk":o},h=e=>({[s]:{},[i]:{url:e},[n]:{productId:e},[a]:{url:e},[d]:{},[c]:{productId:e}}),m={[s]:l.FAVORITE_OFFER,[i]:l.FAVORITE_QUERY,[n]:l.FAVORITE_PRODUCT},v={generate(e){var t;const r=Error(e);throw null==(t=window.opbox)||t.reportError(r),r}},g={login(e){const t=p[e];t||v.generate("Unsupported marketplace: "+e);const{pathname:r,search:o}=window.location;var s;window.location.assign(`/${t}?origin_url=${s=r+o,window.encodeURIComponent(s)}`)}},w=(e,t)=>window.opbox.edge.post(e.url,e.payload,t),y=(e,t)=>window.opbox.edge.delete(e.url,t),f=(e,t,r)=>{const o=[u[e],t].join("/");return o||v.generate("Unsupported mode: "+e),{url:o,payload:r}},I=(e,t,r)=>{const o=u[e];return o||v.generate("Unsupported mode: "+e),{url:o,payload:Object.assign(Object.assign({},r),h(t)[e]||{})}};var b="add";const F={withCredentials:!0},O=e=>Object.assign(Object.assign({},F),{},{headers:{Accept:e,"Content-Type":e}});var R="application/vnd.allegro.public.v1+json",E="application/vnd.allegro.public.v2+json";const P={async process(e,t,r,o){let l;try{l=await{[s](){return t===b?(e=f(s,r,o),i=O(E),window.opbox.edge.put(e.url,{},i)):y(f(s,r,o),O(E));var e,i},[i](){return t===b?w(I(i,r,o),O(R)):y(f(i,r,o),O(R))},[n](){return t===b?w(I(n,r,o),O(R)):y(f(i,r,o),O(R))},[a](){return w(I(a,r,o),O(R))},[d](){return Promise.reject(Error('Checkup method for "offers" not implemented'))},[c](){return w(I(c,r,o),O(R))}}[e]()}catch(u){v.generate(`Favorites: '${u.message}'`)}return l}},S={saveItem(e,t){try{return window.localStorage.setItem(m[e],JSON.stringify(t)),Promise.resolve(!0)}catch(r){return Promise.resolve(!1)}},loadItem(e){const t=JSON.parse(window.localStorage.getItem(m[e])||"{}");return Promise.resolve(t)},removeItem(e){return window.localStorage.removeItem(m[e]),Promise.resolve(!0)}},j=(({pluginName:e,clientImplementationVersion:t})=>{try{return JSON.parse(window.document.querySelector(`script[data-serialize-plugin-name="${e}"][data-civ="${t}"]`).textContent)}catch(v){return window.opbox.reportError(Error(`Missing serialized props of plugin "${e}", with civ "${t}"`)),{}}})({pluginName:e,clientImplementationVersion:"fd8"});j&&window.opbox.plugin.register({name:e},new class{constructor({props:e}){var r=this;this.props=void 0,this.listeners=new Set,this.loginRedirectReady=void 0,this.addStatusChangeListener=e=>{const t="function"==typeof e;return t&&this.listeners.add(e),()=>{t&&this.listeners.delete(e)}},this.init=async()=>{const e=[],o=[s,n,i];var a,d=!1,c=!1;try{for(var l,u=(e=>{var r,o,s,i=2;for("undefined"!=typeof Symbol&&(o=Symbol.asyncIterator,s=Symbol.iterator);i--;){if(o&&null!=(r=e[o]))return r.call(e);if(s&&null!=(r=e[s]))return new t(r.call(e));o="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")})(o);d=!(l=await u.next()).done;d=!1){const t=l.value;try{if(r.props.userLoggedIn){const{itemId:r,params:o={}}=await S.loadItem(t);null!=r&&(await P.process(t,b,r,o).then((()=>S.removeItem(t))),e.push({mode:t,itemId:r,options:o,isFavorite:!0}))}else await S.removeItem(t)}catch(v){}}}catch(p){c=!0,a=p}finally{try{d&&null!=u.return&&await u.return()}finally{if(c)throw a}}return e},this.addFavorite=(e,t,r={})=>this.props.userLoggedIn?P.process(e,b,t,r).then((o=>(this.notifyStatusListeners({mode:e,itemId:t,options:r,isFavorite:!0}),o))):S.saveItem(e,{itemId:t,params:r}).then((()=>{g.login(this.props.marketplaceId)})),this.removeFavorite=(e,t,r={})=>this.props.userLoggedIn?P.process(e,"remove",t,r).then((o=>(this.notifyStatusListeners({mode:e,itemId:t,options:r,isFavorite:!1}),o))):S.saveItem(e,{itemId:t,params:r}).then((()=>{g.login(this.props.marketplaceId)})),this.checkupFavorite=(e,t,r={})=>this.props.userLoggedIn?P.process(e,"checkup",t,r):Promise.reject(),this.getPublicApi=()=>({mode:{Offers:s,Queries:i,Products:n,WatchedQuery:a,WatchedOffers:d,WatchedProductQuery:c},addFavorite:this.addFavorite,removeFavorite:this.removeFavorite,checkupFavorite:this.checkupFavorite,onFavoriteStatusChange:this.addStatusChangeListener,loginRedirectReady:this.loginRedirectReady}),this.props=e,this.loginRedirectReady=new Promise((e=>{this.init().then((t=>{t.length>0&&e(t)}))}))}notifyStatusListeners(e){this.listeners.forEach((t=>{t(e)}))}}({props:j}).getPublicApi());
//# sourceMappingURL=index.es6-pl-PL_6fc280c6.js.map