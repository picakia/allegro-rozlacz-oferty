!function(){"use strict";var e,r={};function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function t(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(i=function(e,r){if("object"!==n(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,"string");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return e+""}(o.key),"symbol"===n(i)?i:i+""),o)}var i}function o(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function i(){return"serviceWorker"in window.navigator}function u(){if(!i())return Promise.reject();try{return window.navigator.serviceWorker.register("/service-worker.js").then((function(){return window.navigator.serviceWorker.ready})).catch((function(e){return window.opbox.plugin.get("sentry").then((function(r){return r.captureException(e)})).catch((function(){console.error(e)})),Promise.reject()}))}catch(e){return Promise.reject()}}function c(){if(!i())return Promise.resolve(void 0);try{return window.navigator.serviceWorker.getRegistration()}catch(e){return Promise.resolve(void 0)}}e=r,"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0});var a={headers:{Accept:"application/vnd.allegro.public.v1+json","Content-Type":"application/json"},withCredentials:!0};function s(){return i()&&"PushManager"in window}function p(e){return null!==e}function l(e){return void 0===e?Promise.resolve(null):e.pushManager.getSubscription()}function f(e){return void 0===e?Promise.reject():l(e).then((function(e){return p(e)?e.unsubscribe().then((function(){return e.endpoint})):Promise.reject()}))}function v(e){var r=e.toJSON(),n=r.endpoint,t=r.keys,o=void 0===t?{}:t,i=o.auth,u=o.p256dh;return window.opbox.edge.post("/notifications/subscriptions",{endpoint:n,auth:i,p256dh:u},a)}function b(e){return window.opbox.edge.post("/notifications/subscriptions/remove",{endpoint:e},a)}var d=function(){return c().then(l).then(p).catch((function(){return!1}))},h=function(){return c().then(f).then(b)},y=function(){return Promise.resolve(s())},w=o((function e(r){var n=this,t=r.applicationServerKey;!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e),this.applicationServerKey=void 0,this.subscribeToWebPush=function(){return(s()?new Promise((function(e,r){var n=Notification.requestPermission((function(r){e(r)}));n&&n.then(e,r)})).then((function(e){if("granted"!==e)throw Error("Permission not granted.")})):Promise.reject()).then(u).then((function(e){return function(e,r){var n={userVisibleOnly:!0,applicationServerKey:r};return e.pushManager.subscribe(n)}(e,n.applicationServerKey)})).then(v)},this.getPublicApi=function(){return{isSubscribedToWebPush:d,unsubscribeFromWebPush:h,isWebPushSupported:y,subscribeToWebPush:n.subscribeToWebPush}},this.applicationServerKey=function(e){for(var r=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),n=window.atob(r),t=new Uint8Array(n.length),o=0;o<n.length;o+=1)t[o]=n.charCodeAt(o);return t}(t)})),g=function(e){try{return JSON.parse(window.document.querySelector('script[data-serialize-plugin-name="serviceWorker"][data-civ="20c"]').textContent)}catch(e){return window.opbox.reportError(Error('Missing serialized props of plugin "serviceWorker", with civ "20c"')),{}}}(),m=g.serviceWorkerConfiguration,P=g.applicationServerKey;m&&m.enabled&&P&&window.opbox.plugin.register({name:"serviceWorker"},new w({window:window,applicationServerKey:P}).getPublicApi()),c().then((function(e){e&&"function"==typeof window.cm&&window.cm("send","event",{category:"Performance",label:"ServiceWorkerRegistered"})}));var S=window;for(var j in r)S[j]=r[j];r.__esModule&&Object.defineProperty(S,"__esModule",{value:!0})}();
//# sourceMappingURL=index_c0d44ef3.js.map