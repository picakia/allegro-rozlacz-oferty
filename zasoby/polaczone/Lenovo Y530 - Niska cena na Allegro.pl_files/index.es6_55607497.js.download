const e="cart";let t=(e=>(e.CART_CAPACITY_EXCEEDED="OFFER_CART_CAPACITY_EXCEEDED",e))({});const r="application/vnd.allegro.public.v5+json",i=({code:e})=>{const{CART_CAPACITY_EXCEEDED:r}=t;return e===r},a=e=>t=>window.opbox.edge.post("/carts/changeQuantityCommand",{items:t},{headers:{Accept:r,"Content-Type":r},withCredentials:!0}).catch((({status:t,data:r})=>{if(422===t&&r&&r.errors&&r.errors.find(i))return window.location.assign(`/${e}?error=CART_CAPACITY_EXCEEDED`);throw Error(`Failed to add to cart. Status: ${t}. Data: ${JSON.stringify(r)}.`)})),n=Error("Failed to render precart layer"),s={showPrecartLayer:!1},{cartConfiguration:o}=(({pluginName:e,clientImplementationVersion:t})=>{try{return JSON.parse(window.document.querySelector(`script[data-serialize-plugin-name="${e}"][data-civ="${t}"]`).textContent)}catch(r){return window.opbox.reportError(Error(`Missing serialized props of plugin "${e}", with civ "${t}"`)),{}}})({pluginName:e,clientImplementationVersion:"030"});o&&window.opbox.plugin.register({name:e},new class{constructor({window:e,props:t}){this.quantityChangeListeners=void 0,this.window=void 0,this.props=void 0,this.changeQuantity=void 0,this.changeItems=(e,t,{showPrecartLayer:r}=s)=>this.changeQuantity(e).then((()=>{const i=e.reduce(((e,{delta:t})=>e+t),0);return this.triggerQuantityChangeListeners(i),r?this.window.opbox.page.render.fragment({pathname:this.props.precartLayerUrl,additionalQueryParameters:t}).catch((()=>{this.window.opbox.reportError(n)})):Promise.resolve()})).catch((e=>{throw this.window.opbox.reportError(e),e})),this.addOffer=(e,t)=>this.addOffers([e],t),this.addOffers=(e,t)=>this.changeItems(e.map((({itemId:e,quantity:t,sellerId:r,category:i})=>({itemId:e,delta:t,sellerId:r,navCategoryId:i&&i.id,navTree:i&&i.tree}))),{precartOfferId:e.map((({itemId:e})=>e)),precartSellerId:e[0].sellerId,itemQuantity:e.map((({itemId:e,quantity:t})=>`${e}:${t}`))},t),this.removeOffer=({itemId:e,quantity:t,sellerId:r,allowDelete:i})=>this.changeItems([Object.assign({itemId:e,delta:-1*t,sellerId:r},!0===i&&{allowDelete:i})]),this.addBundle=({bundleMainItemId:e,quantity:t,sellerId:r,rebateId:i,itemsIds:a},n)=>this.changeItems([{itemId:e,delta:t,sellerId:r,rebateId:i}],{precartOfferId:a,precartSellerId:r,rebateId:i,quantity:t.toString(10)},n),this.triggerQuantityChangeListeners=e=>{this.quantityChangeListeners.forEach((t=>t(e)))},this.registerQuantityChangeListener=e=>{this.quantityChangeListeners.push(e)},this.unregisterQuantityChangeListener=e=>{this.quantityChangeListeners=this.quantityChangeListeners.filter((t=>t!==e))},this.window=e,this.quantityChangeListeners=[],this.props=t,this.changeQuantity=a(this.getCartPathname())}getCartPathname(){const[,e="koszyk"]=this.props.precartLayerUrl.split("/");return e}getPublicApi(){return{addBundle:this.addBundle,addOffer:this.addOffer,addOffers:this.addOffers,removeOffer:this.removeOffer,registerQuantityChangeListener:this.registerQuantityChangeListener,unregisterQuantityChangeListener:this.unregisterQuantityChangeListener}}}({window,props:o}).getPublicApi());
//# sourceMappingURL=index.es6_55607497.js.map