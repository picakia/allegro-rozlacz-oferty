const e=e=>"SUGGESTION"===e.type,t=e=>"HORIZONTAL_LIST"===e.type,s=s=>e(s)||t(s),i="advanced-search-criteria",r="remove-recently-searched",n="rewrite-recently-searched",o="suggestion",a="horizontal-list",h="suggestion-dsa-button",c=e=>`[data-role="${e}"]`,d=c(i),u=c("filters-dropdown-toggle"),l=c("filters-selected-option"),m=c("logo-wrapper"),g=c("multisearch-button"),p=c("remove-query"),v=c(r),S=c(n),I=c(h),E=c("search-button"),y=c("search-form"),b=c("search-input"),L=c("suggester"),N=(c(o),c("visual-search-link")),f="blur",w="change",k="click",_="focus",C="input",A="keydown",x="mousedown",P="submit",$="touchmove",T="RECEIVE_SUGGESTIONS",O="TOGGLE_IS_EXPANDED",R="CLICK_SUGGESTION",U="CLICK_HORIZONTAL_LIST",B="CLICK_REWRITE_SUGGESTION",j="CLICK_REMOVE_SUGGESTION";let D=()=>({emit(e,...t){for(let s=0,i=this.events[e]||[],r=i.length;s<r;s++)i[s](...t)},events:{},on(e,t){var s;return((s=this.events)[e]||(s[e]=[])).push(t),()=>{var s;this.events[e]=null==(s=this.events[e])?void 0:s.filter((e=>t!==e))}}});const F={ActiveSuggestionIndex:"activeSuggestionIndex",NextPhrase:"nextPhrase",Suggestions:"suggestions",Tracking:"tracking",InputPhrase:"inputPhrase",SelectedFilterIndex:"selectedFilterIndex",CheckedAdvancedSearchCriteriaIds:"checkedAdvancedSearchCriteriaIds"};class z{constructor(e,t=D()){this.state=void 0,this.props=e,this.emitter=t,this.state=(({inputPhrase:e,filters:t={list:[],selected:0},advancedSearchCriterias:s=[]})=>{var i;return{activeSuggestionIndex:-1,inputPhrase:e,nextPhrase:e,selectedFilterIndex:null!=(i=t.selected)?i:0,suggestions:[],tracking:{},checkedAdvancedSearchCriteriaIds:s.filter((({checked:e})=>e)).map((({id:e})=>e))}})(e)}on(...e){return this.emitter.on(...e)}}Object.values(F).forEach((e=>Object.defineProperty(z.prototype,e,{get(){return this.state[e]},set(t){this.state=Object.assign(Object.assign({},this.state),{},{[e]:t}),this.emitter.emit(e,this.state)}})));const q=e=>!!e&&!!e.type,G="m0qj_5r",H="msbw_rf",W="mldj_rf",M="mtag_rf",V="mm2b_rf",K="m911_5r",Q="mefy_5r",Y="mnyp_5r",Z="mdwl_5r",J="mjyo_lo",X="mjyo_6x",ee="mgmw_wo",te="mgmw_ag",se="msts_me",ie="msts_n7",re="mqen_m6",ne="mpof_5r",oe="mpof_ki",ae="mpof_vs",he="mpof_z0",ce="m389_6m",de="mp0t_0a",ue="mgn2_14",le="mgn2_12",me="m9qz_yp",ge="mse2_40",pe="mse2_1",ve="mqvr_2",Se="mqu1_21",Ie="mqu1_16",Ee="mqu1_1",ye="mp4t_16",be="mp4t_0",Le="mryx_0",Ne="munh_0",fe="m3h2_0",we="mj6k_n7",ke="m2ha_2",_e="mjt1_n2",Ce="m8qd_vz",Ae="mjir_sv",xe="meqh_en",Pe="mg9e_8",$e="mg9e_0",Te="mj7a_8",Oe="mj7a_0",Re="mh36_8",Ue="mh36_0",Be="mvrt_16",je="mvrt_8",De="mvrt_0",Fe="mp7g_f6",ze="mp7g_oh",qe="mj9z_5r",Ge="mhd5_0m",He="mli8_k4",We="mtsp_ib",Me="msa3_z4",Ve="m7er_k4",Ke="m7er_40",Qe=Ee,Ye="CATEGORY",Ze="DEPARTMENT",Je="ENDED",Xe="USER_NAME",et="USERS",tt="CHARITY_GOALS",st="CHARITY_ORGANIZATION",it="CHARITY_ORGANIZATIONS";function rt(e,t,s){const i=s.filters.list[t.selectedFilterIndex];return!!q(i)&&e.includes(i.type)}const nt=["CHARITY_GOAL_OFFERS"],ot=[Je,et,tt,it];function at(e,t){return rt(ot,e,t)||!t.advancedSearchCriterias.length}const ht=(e,t)=>e.reduce((([e,s],{queryParameter:i,id:r})=>(t.includes(r)?e.push(i):s.push(i),[e,s])),[[],[]]),ct=(e,t,s)=>{t?e.classList.add(...s):e.classList.remove(...s)},dt=(e,t)=>ct(e,!t,["m9vn_gl"]),ut=(e,t)=>ct(e,!t,["_535b5_LGnXi"]),lt=()=>!0,mt=(e,t)=>e!==t,gt=(e,t,s,i=mt)=>{i(e[t],s)&&(e[t]=s)},pt=(e,t)=>{gt(e,F.InputPhrase,t)},vt=(e,t)=>{gt(e,F.NextPhrase,t,lt)},St=(e,t)=>{gt(e,F.CheckedAdvancedSearchCriteriaIds,t,((e,t)=>e.length!==t.length||!e.every((e=>t.includes(e)))))},It=e=>({type:e.type,id:e.id});function Et(e){return(...t)=>{"requestIdleCallback"in window?requestIdleCallback((()=>e(...t))):setTimeout((()=>e(...t)),0)}}class yt{constructor(i,r,n,o=window){this.previousHash="",this.searchFormNode=void 0,this.searchInputNode=void 0,this.searchButtonNode=void 0,this.filtersList=void 0,this.previousCheckedAdvancedSearchCriteriaIds=void 0,this.previousSelectedFilterIndex=void 0,this.stateUnbinders=[],this.suggesterUnbinders=[],this.sendSuggestLayerViewEvent=(e,t)=>{if(!e)return;const s={typedPhrase:t.trim()};this.targetWindow.opbox.analytics.sendItemViewEvent({contextNode:this.searchInputNode,label:"suggestLayerView",customParams:s})},this.sendSuggestHintClickEvent=e=>{const t=e.tracking.type+"_REDIRECT",s=Object.assign({typedPhrase:this.store.inputPhrase.trim(),details:Object.assign({phrase:e.completionText},e.tracking)},this.store.tracking);this.targetWindow.opbox.analytics.sendBoxInteractionEvent({contextNode:this.searchInputNode,label:"suggestHintClick",value:t,customParams:s})},this.sendHorizontalListClickEvent=e=>{const t=Object.assign(Object.assign({typedPhrase:this.store.inputPhrase.trim()},e.items[0].tracking),this.store.tracking);this.targetWindow.opbox.analytics.sendBoxInteractionEvent({contextNode:this.searchInputNode,label:"horizontalListItemClick",customParams:t})},this.sendSearchInteraction=e=>{var t;const s=e.type===A?"searchEnter":"searchClick",i={typedPhrase:this.store.inputPhrase.trim(),scope:It(null!=(t=this.filtersList[this.store.selectedFilterIndex])?t:{})};this.targetWindow.opbox.analytics.sendBoxInteractionEvent({contextNode:this.searchInputNode,label:s,customParams:i})},this.sendScopeChangeEvent=({selectedFilterIndex:e})=>{const t={scope:It(this.filtersList[e]),previousScope:It(this.filtersList[this.previousSelectedFilterIndex])};this.targetWindow.opbox.analytics.sendBoxInteractionEvent({contextNode:this.searchInputNode,label:"scopeChange",customParams:t}),this.previousSelectedFilterIndex=e},this.sendSuggestionsShowEvent=(i,r)=>{const n=Object.assign({status:i,typedPhrase:r.trim(),suggestions:(o=this.store.suggestions,o.filter(s).reduce(((e,s)=>{const i=t(s)?s.items[0].tracking.type:s.tracking.type;return e.types[i]?e.types[i]+=1:e.types[i]=1,e.count+=1,e}),{types:{},count:0})),scope:It(this.filtersList[this.store.selectedFilterIndex])},this.store.tracking);var o;const a=(t=>{const s=this.store.suggestions.filter(e).find((e=>"AD"===e.tracking.type));return s?s.tracking.campaignId:null})();a&&(n.campaignId=a),this.targetWindow.opbox.analytics.sendItemViewEvent({contextNode:this.searchInputNode,label:"suggestionsShow",customParams:n}),this.sendAdsDSSSuggestionsShowEvents()},this.sendAdsDSSSuggestionsShowEvents=()=>{this.store.suggestions.filter(e).filter((e=>"PREMIUMAD"===e.tracking.type)).forEach((e=>{const t={analyticsId:e.tracking.emissionUnitId,analyticsEmissionTimestamp:e.tracking.timestamp,analyticsSignature:e.tracking.sig};this.targetWindow.opbox.analytics.sendItemViewEvent({contextNode:this.searchInputNode,label:"showDSSItems",customParams:t})}))},this.sendAdvancedSearchCheckedEvent=({checkedAdvancedSearchCriteriaIds:e})=>{const t=(s=e,i=this.previousCheckedAdvancedSearchCriteriaIds,[...s.filter((e=>!i.includes(e))),...i.filter((e=>!s.includes(e)))])[0];var s,i;this.targetWindow.opbox.analytics.sendBoxInteractionEvent({contextNode:this.searchInputNode,label:"advancedSearchCriteria",value:e.includes(t).toString(),customParams:{id:t}}),this.previousCheckedAdvancedSearchCriteriaIds=[...e]},this.sendSuggestionRemoveClickEvent=(e,t)=>{const s=e.tracking.type+"_REMOVE",i=Object.assign({typedPhrase:t.trim(),details:Object.assign({phrase:e.completionText},e.tracking)},this.store.tracking);this.targetWindow.opbox.analytics.sendBoxInteractionEvent({contextNode:this.searchInputNode,label:"suggestionRemoveClick",value:s,customParams:i})},this.sendRewriteClickEvent=(e,t)=>{const s=e.tracking.type+"_REWRITE",i=Object.assign({typedPhrase:t.trim(),details:Object.assign({phrase:e.completionText},e.tracking)},this.store.tracking);this.targetWindow.opbox.analytics.sendBoxInteractionEvent({contextNode:this.searchInputNode,label:"suggestRewriteClick",value:s,customParams:i})},this.baseNode=i,this.store=r,this.props=n,this.targetWindow=o,this.searchFormNode=i.querySelector(y),this.searchInputNode=i.querySelector(b),this.searchButtonNode=i.querySelector(E),this.filtersList=n.filters.list,this.previousCheckedAdvancedSearchCriteriaIds=[...r.checkedAdvancedSearchCriteriaIds],this.previousSelectedFilterIndex=this.store.selectedFilterIndex}mount(e){this.addEventListeners(),this.addStateListeners(),this.addSuggesterListeners(e)}unmount(){this.removeEventListeners(),this.removeStateListeners(),this.removeSuggesterListeners()}addEventListeners(){this.searchFormNode.addEventListener(P,this),this.searchInputNode.addEventListener(A,this),this.searchButtonNode.addEventListener(A,this),this.searchButtonNode.addEventListener(x,this)}removeEventListeners(){this.searchFormNode.removeEventListener(P,this),this.searchInputNode.removeEventListener(A,this),this.searchButtonNode.removeEventListener(A,this),this.searchButtonNode.removeEventListener(x,this)}addStateListeners(){this.stateUnbinders.push(this.store.on(F.SelectedFilterIndex,this.sendScopeChangeEvent),this.store.on(F.CheckedAdvancedSearchCriteriaIds,this.sendAdvancedSearchCheckedEvent))}addSuggesterListeners(e){this.suggesterUnbinders.push(e.on(R,this.sendSuggestHintClickEvent),e.on(U,this.sendHorizontalListClickEvent),e.on(O,Et(this.sendSuggestLayerViewEvent)),e.on(T,Et(this.sendSuggestionsShowEvent)),e.on(j,Et(this.sendSuggestionRemoveClickEvent)),e.on(B,Et(this.sendRewriteClickEvent)))}removeStateListeners(){this.stateUnbinders.forEach((e=>e()))}removeSuggesterListeners(){this.suggesterUnbinders.forEach((e=>e()))}handleEvent(e){e.type===P&&this.onSubmit(),e.type===A&&"Enter"===e.key&&this.sendSearchInteraction(e),e.type===x&&this.sendSearchInteraction(e)}onSubmit(){if(-1===this.store.activeSuggestionIndex)return;const e=this.store.suggestions.filter(s)[this.store.activeSuggestionIndex];t(e)?this.sendHorizontalListClickEvent(e):this.sendSuggestHintClickEvent(e)}}const bt={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#x27;"},Lt=/<|>|&|"|'/g,Nt=(RegExp(Array.from("javascript:",(e=>e+"[\\n\\r\\t]*")).join(""),"ig"),e=>bt[e]);class ft{constructor(e,t){this.$=e[0];for(let s=0;s<t.length;s++){const i=t[s];if(Array.isArray(i))for(let e=0;e<i.length;e++)this.$esc(i[e]);else this.$esc(i);this.$+=e[s+1]}}$esc(e){this.$+=e instanceof ft?e.$:(e+"").replace(Lt,Nt)}toString(){return this.$}}const wt=(e,...t)=>new ft(e,t);let kt="pl-PL";const _t={"pl-PL":{"Category and search options":[["",["Kategoria i opcje wyszukiwania"]]],"All categories":[["",["Wszystkie kategorie"]]],Expired:[["",["Zakończone"]]],Everywhere:[["",["Wszędzie"]]],Sellers:[["",["Sprzedawcy"]]],Categories:[["",["Kategorie"]]],"Other options":[["",["Inne opcje"]]],"Charity organizations":[["",["Organizacje charytatywne"]]],"Fundraising goals":[["",["Cele charytatywne"]]],"search for anything":[["",["czego szukasz?"]]],search:[["",["szukaj"]]],"Remove suggestion from history":[["",["Usuń podpowiedź z histori"]]],"search many":[["",["szukaj wielu"]]],"multiple product search":[["",["wyszukiwanie wielu przedmiotów"]]],"Home and Garden":[["",["Dom i Ogród"]]],Kids:[["",["Dziecko"]]],Electronics:[["",["Elektronika"]]],"Business and Services":[["",["Firma i usługi"]]],"Collections and Art":[["",["Kolekcje i sztuka"]]],"Culture and Entertainment":[["",["Kultura i rozrywka"]]],Fashion:[["",["Moda"]]],Automotive:[["",["Motoryzacja"]]],"Real Estate":[["",["Nieruchomości"]]],"Sports and Travel":[["",["Sport i turystyka"]]],Supermarket:[["",["Supermarket"]]],Beauty:[["",["Uroda"]]],Health:[["",["Zdrowie"]]],"Check details concerning ads":[["",["Sprawdź szczegóły dotyczące reklamy"]]],"Search by image":[["",["Szukaj obrazem"]]],"Order in one shipment":[["",["zamów w jednej przesyłce"]]]}},Ct=/({{[^}]+}}|{%[^%}]+%})/g,At=/({{[^}]+}})/g,xt=/({%[^%}]+%})/g,Pt=/({{\s*|\s*}}|{%\s*|\s*%})/g,$t={"pl-PL":e=>1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2};function Tt(e,t=""){if("string"==typeof e)throw Error("Translation has to be an array");return e.find((e=>e[0]===t))[1]}const Ot=(e,t,s)=>{const i=_t[kt][e];if(!i)throw Error(`Missing translation for lang "${kt}" and key "${e}"`);return t?((e,t,s)=>{let i=Tt(e,t.context);return parseInt(t.count,10)>=0?i=((e,t)=>{const s=$t[kt](t);return"boolean"!=typeof s?e[s]:e[s?1:0]})(i,t.count):[i]=i,((e,t,s)=>{if(s){let s=0;return e.split(Ct).map((i=>{if(i.match(xt)){const r=t.formatters[s];if(r)return s+=1,r(i.replace(Pt,""));throw Error(`Missing translation formatter for "${e}"`)}return i.match(At)?t[i.replace(Pt,"")]:i}))}const i=e.match(Ct);let r=0;return i?i.reduce(((s,i)=>{const n=i.replace(Pt,"");if(i.match(xt)){const o=t.formatters[r];if(o)return r+=1,s.replace(i,o(n));throw Error(`Missing translation formatter for "${e}"`)}return i.match(At)?s.replace(i,t[n]):s}),e):e})(i,t,s)})(i,t,s):Tt(i)[0]},Rt="i150e",Ut="im1ut",Bt="ipmse",jt=ue+" "+de+" "+Se+" "+ee+" "+He+" "+he+" mpof_5r_x",Dt=ue+" "+de+" "+Se+" "+ee+" "+He+" "+ne+" mpof_z0_x";let Ft,zt,qt=e=>e;class Gt{constructor(e,t,s){this.dropdownToggleNode=void 0,this.selectedOptionNode=void 0,this.filtersList=void 0,this.stateUnbinders=[],this.store=t,this.dropdownToggleNode=e.querySelector(u),this.selectedOptionNode=e.querySelector(l),this.filtersList=s.filters.list}mount(){this.addStateListeners(),this.addEventListeners(),this.updateSelectedFilter(this.dropdownToggleNode)}unmount(){this.removeEventListeners(),this.removeStateListeners()}addEventListeners(){this.dropdownToggleNode.addEventListener(w,this)}removeEventListeners(){this.dropdownToggleNode.removeEventListener(w,this)}addStateListeners(){this.stateUnbinders.push(this.store.on(F.SelectedFilterIndex,(e=>this.handleSelectedFilterIndexChange(e))))}removeStateListeners(){this.stateUnbinders.forEach((e=>e()))}handleEvent(e){e.type===w&&this.onChange(e)}handleSelectedFilterIndexChange({selectedFilterIndex:e}){var t;const s=null!=(t=this.filtersList[e])?t:this.filtersList[0];var i;this.selectedOptionNode.innerHTML=(i=s.name)?Ot("All categories")===i?wt(Ft||(Ft=qt`<span class="${0}" aria-hidden="true">${0}</span><span class="${0}" aria-hidden="true">${0}</span>`),jt,Ot("Everywhere"),Dt,i):wt(zt||(zt=qt`<span aria-hidden="true">${0}</span>`),i):""}onChange({target:e}){this.updateSelectedFilter(e)}updateSelectedFilter({value:e}){const t=this.filtersList.findIndex((({url:t})=>t===e));var s;s=this.store,gt(s,F.SelectedFilterIndex,t)}}const Ht=["p","us_id","string","description","show-raty0-disclaimer","fromCart"],Wt=(e,t)=>t.some((t=>{return i=e,(s=t).key===i.key&&s.value===i.value;var s,i})),Mt=(e,t)=>Wt(t,e)?e:[...e,t],Vt=({key:e,value:t})=>[e,t].map(encodeURIComponent).join("="),Kt=({value:e})=>""!==e&&void 0!==e,Qt=(e,t,s=[],i=[])=>{const r=e.includes(window.location.pathname)&&!e.includes(t)?(e=>{const t=new URLSearchParams(e);return Array.from(t).filter((([e,t])=>e&&t)).map((([e,t])=>({key:e,value:t})))})(window.location.search):[],n=r.filter((o=Ht,e=>!o.includes(e.key))).concat(s).filter((e=>t=>!Wt(t,e))(i)).reduce(Mt,[]).filter(Kt).map(Vt).join("&");var o;const a=e.includes("?")?"&":"?";return`${e}${n?a:""}${n}`},Yt=["ALL",Ze,Je,et];class Zt{constructor(e,t,s){this.searchFormNode=void 0,this.multiSearchControl=void 0,this.visualSearchControl=void 0,this.stateUnbinders=[],this.baseNode=e,this.store=t,this.props=s,this.searchFormNode=e.querySelector(y),this.multiSearchControl=e.querySelector(g),this.visualSearchControl=e.querySelector(N)}mount(){this.addEventListeners(),this.addStateListeners()}unmount(){this.removeEventListeners(),this.removeStateListeners()}addEventListeners(){this.multiSearchControl&&this.multiSearchControl.addEventListener(k,this),this.searchFormNode.addEventListener(P,this)}removeEventListeners(){this.multiSearchControl&&this.multiSearchControl.removeEventListener(k,this),this.searchFormNode.removeEventListener(P,this)}addStateListeners(){this.stateUnbinders.push(this.store.on(F.InputPhrase,(e=>this.handleInputPhraseChange(e))))}removeStateListeners(){this.stateUnbinders.forEach((e=>e()))}handleEvent(e){e.type===P&&this.onSubmit(e),e.type===k&&this.onMultisearchClick(e)}handleInputPhraseChange({inputPhrase:e}){this.multiSearchControl&&ut(this.multiSearchControl,0===e.length),this.visualSearchControl&&ut(this.visualSearchControl,0===e.length)}onMultisearchClick(e){e.preventDefault(),((e,t=window)=>{const{pathname:s,search:i,hash:r}=t.location;e!==r&&(t.history.pushState({previousHash:r},t.document.title,`${s}${i}${e}`),t.dispatchEvent(new HashChangeEvent("hashchange")))})(e.currentTarget.hash)}onSubmit(e){var i;e.preventDefault();const r=this.store.inputPhrase.trim(),n=null!=(i=this.props.filters.list[this.store.selectedFilterIndex])?i:{};if(!r&&rt(Yt,this.store,this.props)&&-1===this.store.activeSuggestionIndex)return;const[o,a]=ht(this.props.advancedSearchCriterias,this.store.checkedAdvancedSearchCriteriaIds);let h;const c=[...o,...this.props.staticQueryParameters],d=a;if(-1!==this.store.activeSuggestionIndex){const e=this.store.suggestions.filter(s)[this.store.activeSuggestionIndex];h=t(e)?e.items[0].url:e.url}else n.url?n.type===et?h=`${n.url}/${encodeURIComponent(r)}`:(h=n.url,c.unshift({key:"string",value:r})):(h=this.props.listingPathname,c.unshift({key:"string",value:r}));const u=Qt(h,this.props.listingPathname,c,d);window.document.location.assign(u)}}const Jt="BLUR",Xt="CLEAR",es="CLICK",ts="INPUT",ss="KEY_ARROW_DOWN",is="KEY_ARROW_UP",rs="KEY_ESCAPE",ns="KEY_DELETE",os="KEY_TAB";class as{constructor(e,t,s=D(),i=window){this.searchInputNode=void 0,this.clearInputButtonNode=void 0,this.stateUnbinders=[],this.suggesterUnbinders=[],this.onStateInputPhrase=({inputPhrase:e})=>{this.clearInputButtonNode&&ut(this.clearInputButtonNode,!!e)},this.onStateNextPhrase=({nextPhrase:e})=>{this.updateSearchInputValue(e)},this.onSuggesterToggleIsExpanded=e=>{e?this.addGlobalEventListeners():this.removeGlobalEventListeners()},this.onSuggesterClickSuggestionActionIcon=()=>{this.focusNode()},this.focusNode=()=>{this.searchInputNode.focus()},this.blurNode=()=>{this.searchInputNode.blur()},this.onClearInputClick=()=>{this.focusNode(),this.updateSearchInputValue(""),this.emitter.emit(Xt)},this.handleOnKeydown=e=>{const t={ArrowDown:this.onArrowDownPressAndEmit,ArrowUp:this.onArrowUpPressAndEmit,Escape:this.onEscapePressAndEmit,Delete:this.emitOnDeletePress,Tab:this.emitOnTabPress}[e.key];t&&t(e)},this.emitOnInput=e=>this.emitter.emit(ts,e),this.onBlurAndEmit=()=>{this.emitter.emit(Jt)},this.emitOnClick=()=>this.emitter.emit(es),this.onArrowDownPressAndEmit=e=>{e.preventDefault(),this.emitter.emit(ss)},this.onArrowUpPressAndEmit=e=>{e.preventDefault(),this.emitter.emit(is)},this.emitOnTabPress=()=>this.emitter.emit(os),this.emitOnDeletePress=()=>this.emitter.emit(ns),this.onEscapePressAndEmit=()=>{this.updateSearchInputValue(""),this.emitter.emit(rs)},this.baseNode=e,this.store=t,this.emitter=s,this.targetWindow=i,this.searchInputNode=e.querySelector(b),this.clearInputButtonNode=e.querySelector(p)}mount(e){this.addEventListeners(),this.addStateListeners(),this.addSuggesterListeners(e)}unmount(){this.removeEventListeners(),this.removeGlobalEventListeners(),this.removeStateListeners(),this.removeSuggesterListeners()}onUpdate({inputPhrase:e=""}){this.updateSearchInputValue(e)}addEventListeners(){this.searchInputNode.addEventListener(f,this),this.searchInputNode.addEventListener(k,this),this.searchInputNode.addEventListener(C,this),this.searchInputNode.addEventListener(A,this),this.searchInputNode.addEventListener(_,this),this.clearInputButtonNode&&this.clearInputButtonNode.addEventListener(k,this)}addGlobalEventListeners(){this.targetWindow.addEventListener($,this,!0)}addStateListeners(){this.stateUnbinders.push(this.store.on(F.InputPhrase,this.onStateInputPhrase),this.store.on(F.NextPhrase,this.onStateNextPhrase))}addSuggesterListeners(e){this.suggesterUnbinders.push(e.on(O,this.onSuggesterToggleIsExpanded),e.on(j,this.onSuggesterClickSuggestionActionIcon),e.on(B,this.onSuggesterClickSuggestionActionIcon))}removeEventListeners(){this.searchInputNode.removeEventListener(f,this),this.searchInputNode.removeEventListener(k,this),this.searchInputNode.removeEventListener(C,this),this.searchInputNode.removeEventListener(A,this),this.searchInputNode.removeEventListener(_,this),this.clearInputButtonNode&&this.clearInputButtonNode.removeEventListener(k,this)}removeGlobalEventListeners(){this.targetWindow.removeEventListener($,this,!0)}removeStateListeners(){this.stateUnbinders.forEach((e=>e()))}removeSuggesterListeners(){this.suggesterUnbinders.forEach((e=>e()))}handleEvent(e){const{type:t,currentTarget:s}=e;if(t===f&&this.onBlurAndEmit(),t===k&&(s===this.searchInputNode&&this.emitOnClick(),s===this.clearInputButtonNode&&this.onClearInputClick()),t===C){const{value:e}=s;this.emitOnInput(e),pt(this.store,e)}t===A&&this.handleOnKeydown(e),t===$&&this.blurNode()}updateSearchInputValue(e){this.searchInputNode.value=e,pt(this.store,e)}}const hs=he+" "+Ve+" "+be+" "+fe+" "+Le+" "+Ne+" "+K+" "+Q+" "+Y+" "+Z+" "+pe+" "+se;let cs,ds=e=>e;const us="mp0t_ji "+le+" mgmw_9u msbw_sk mldj_sk mtag_sk mm2b_sk "+Me+" mg9e_2 mj7a_2 mvrt_4 mh36_4 "+ae+" bd1d4f",ls=re+" "+Fe+" "+ye+" "+we+" chd2o9 chtfmm ch1a2u",ms=ee+" "+ae+" "+re+" "+ze+" "+de+" ch1wyz munh_8",gs=ne+" mpof_z0_s";let ps,vs,Ss,Is=e=>e;function Es(e,t){return at(t,e)?[]:[t.suggestions.length?wt(cs||(cs=ds`<hr class="${0}" />`),hs):"",e.advancedSearchCriterias.map((e=>(({id:e,label:t,badge:s},r)=>wt(vs||(vs=Is`<div data-role="${0}" class="${0}"><input type="checkbox" autocomplete="off" id="${0}" class="${0}" ${0} /><label for="${0}" class="${0}">${0} ${0}</label></div>`),i,"searchInDescriptionChange"===e?gs:"",e,ls,r.checkedAdvancedSearchCriteriaIds.includes(e)?wt(Ss||(Ss=Is`checked`)):"",e,ms,t,(e=>{if(!e)return"";const{textColor:t,backgroundColor:s,text:i}=e;return wt(ps||(ps=Is`<span class="${0}" style="color: ${0}; background-color: ${0};">${0}</span>`),us,t,s,i)})(s)))(e,t)))]}function ys(e){var t,s,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e)){var r=e.length;for(t=0;t<r;t++)e[t]&&(s=ys(e[t]))&&(i&&(i+=" "),i+=s)}else for(s in e)e[s]&&(i&&(i+=" "),i+=s);return i}const bs=function(){for(var e,t,s=0,i="",r=arguments.length;s<r;s++)(e=arguments[s])&&(t=ys(e))&&(i&&(i+=" "),i+=t);return i},Ls="b1kk0",Ns=de,fs=ue+" "+de+" "+me+" "+ge+" mqu1_40 "+We+" "+He+" "+fe+" "+Ne+" "+K+" "+Q+" "+Y+" "+Z+" "+H+" "+W+" "+M+" "+V+" "+ve+" "+Me+" "+re+" "+xe+" "+G+" "+ee+" "+ie+" "+$e+" "+Oe+" "+Ae+" "+ke+" "+Ce+" "+_e+" "+Ls+" "+Fe+" mnjl_0 "+De+" "+Ue+" m9tr_5r mq1m_0 mqm6_0 mp4t_56 mryx_56 _535b5_-9o1L",ws=X+" "+xe+" "+Me+" "+Ge+" "+Rt+" "+ae+" "+ze+" "+Ut+" "+Bt+" "+Pe+" "+je+" "+Te+" "+Re+" "+Ke+" mupj_5k _535b5_dApw7",ks=X+" "+xe+" "+Me+" "+Ge+" "+Rt+" "+ae+" mupj_mm "+ze+" "+Ut+" "+Bt+" "+Pe+" "+je+" "+Te+" "+Re+" "+Ke,_s=ne+" _535b5_EG11e",Cs=J+" "+ze+" "+oe+" "+Pe+" "+Te+" "+Be+" "+Re+" "+qe+" "+ee+" _535b5_iaSxk",As=J+" "+ze+" "+oe+" "+Pe+" "+Te+" "+Be+" "+Re+" "+qe+" "+ee,xs=ce+" mg9e_4 mj7a_4 _535b5_CPoMl",Ps=Ve+" _535b5_sl1f0",$s=xe+" "+Ve+" "+Ee+" _535b5_cr-H6",Ts=le+" "+Ie,Os=ue+" "+Se,Rs=oe+" "+ce+" "+te+" "+Re+" "+je+" "+Me+" "+ye+" mryx_8 munh_56 m3h2_56 _535b5_-NWho",Us=he+" "+Ve+" "+be+" "+fe+" "+Le+" "+Ne+" "+K+" "+Q+" "+Y+" "+Z+" "+pe+" "+se,Bs=de+" "+He+" mgn2_13 "+Ie+" "+te+" "+Re+" "+je,js=xe+" "+oe+" myre_zn "+Pe+" "+Be+" "+Te+" mh36_16 _535b5_qQM4V",Ds=oe+" myre_8v mwdn_0 "+ge+" _535b5_CK4Bx",Fs=ue+" "+de+" "+ee+" "+Se+" "+qe+" "+He+" "+re+" lsaqd lvg0h mx7m_1 m911_co mefy_co mnyp_co mdwl_co mlkp_3c msbw_2 mldj_2 mtag_2 mm2b_2 "+oe+" m7f5_6m "+ce+" msts_9u "+X+" "+Pe+" "+je+" "+Te+" "+Re+" _535b5_qR-IH",zs=ue+" "+de+" "+me+" "+ze+" "+ge+" "+We+" "+He+" "+be+" "+fe+" "+Le+" "+Ne+" "+K+" "+Q+" "+Y+" "+Z+" "+H+" "+W+" "+M+" "+V+" "+ve+" "+Me+" "+re+" "+xe+" "+G+" "+ee+" "+ie+" "+$e+" "+Oe+" "+Ae+" "+ke+" "+Ce+" "+_e+" "+Ls+" "+Ue+" "+De+" "+Ee+" _535b5_8crTO",qs="bnzav "+X+" "+xe+" "+Me+" "+Ge+" "+Rt+" "+$e+" "+De+" "+Oe+" "+Ue+" _535b5_apJT2";let Gs,Hs,Ws=e=>e;function Ms(e){return"SMALL"===e.size?Ts:Os}function Vs(e){return"IMAGE"===e.type?((e,...t)=>wt(Hs||(Hs=Ws`<span data-type="IMAGE" class="${0}"><img src="${0}" alt=""></span>`),bs("_535b5_J8Mvg",t),e.url))(e,Ms(e)):((e,...t)=>wt(Gs||(Gs=Ws`<span class="${0}">${0}</span>`),bs(t),e.text))(e,Ns,(e=>{switch(e.style){case"STRONG":return"m9qz_yq";case"PRIMARY":return"mgmw_s9";case"SECONDARY":return"mgmw_3z";default:return""}})(e),Ms(e))}let Ks,Qs=e=>e;function Ys({buttonClassName:e,iconClassName:t,icon:s,dataRole:i}){return wt(Ks||(Ks=Qs`<button tabindex="-1" aria-hidden="true" type="button" class="${0}" data-role="${0}"><div class="${0}" style="--url: url('${0}');" /></div></button>`),e,i,t,s)}let Zs,Js,Xs,ei,ti,si=e=>e,ii=e=>e;const ri=e=>e.length?wt(ti||(ti=ii`<div class="${0}">${0} ${0}</div>`),Qe,e.map(Vs),wt(ei||(ei=ii`<button type="button" class="${0}" aria-label="${0}" data-role="${0}"><img src="${0}" class="${0}" alt="" /></button>`),zs,Ot("Check details concerning ads"),h,"https://a.allegroimg.com/original/34a646/639f929246af8f23da49cf64e9d7/action-common-information-33306995c6",qs)):"";let ni,oi,ai,hi,ci,di=e=>e;class ui{constructor(e,t,s){this.inputElement=void 0,this.labelElement=void 0,this.stateUnbinders=[],this.onCheckedAdvancedSearchCriteriaIds=({checkedAdvancedSearchCriteriaIds:e})=>{this.inputElement.checked=e.includes(this.itemId)},this.baseNode=e,this.itemId=t,this.store=s,this.inputElement=e.querySelector("input"),this.labelElement=e.querySelector("label")}mount(){this.addEventListeners(),this.addStateListeners()}unmount(){this.removeEventListeners(),this.removeStateListeners()}addEventListeners(){this.labelElement.addEventListener(k,this)}addStateListeners(){this.stateUnbinders.push(this.store.on(F.CheckedAdvancedSearchCriteriaIds,this.onCheckedAdvancedSearchCriteriaIds))}removeEventListeners(){this.labelElement.removeEventListener(k,this)}removeStateListeners(){this.stateUnbinders.forEach((e=>e()))}handleEvent(e){e.type===k&&this.onClick(e)}onClick(e){e.preventDefault();const{checkedAdvancedSearchCriteriaIds:t}=this.store,s=this.inputElement.checked?t.filter((e=>e!==this.itemId)):[...t,this.itemId];St(this.store,s)}}const li=()=>window.opbox.edge;let mi=new AbortController;class gi extends Error{constructor(){super("Request has been aborted"),this.name="RequestAbortedError"}}const pi="aria-selected";class vi{constructor(e,t,s,i){this.anchorNode=void 0,this.store=t,this.component=s,this.emitter=i,this.anchorNode=e.querySelector('a[role="option"]')}mount(){this.addEventListeners()}unmount(){this.removeEventListeners()}addEventListeners(){this.anchorNode&&this.anchorNode.addEventListener(k,this)}removeEventListeners(){this.anchorNode&&this.anchorNode.removeEventListener(k,this)}handleEvent(e){e.preventDefault(),e.stopPropagation(),e.currentTarget===this.anchorNode&&this.onItemClick()}onItemClick(){this.emitter.emit(U,this.component)}markActive(){this.anchorNode&&(this.anchorNode.setAttribute(pi,"true"),vt(this.store,""))}markInactive(){this.anchorNode&&this.anchorNode.removeAttribute(pi)}}const Si="aria-selected";class Ii{constructor(e,t,s,i){this.removeButtonNode=void 0,this.rewriteButtonNode=void 0,this.showDSAInfoButtonNode=void 0,this.anchorNode=e,this.store=t,this.component=s,this.emitter=i,this.rewriteButtonNode=e.querySelector(S),this.removeButtonNode=e.querySelector(v),this.showDSAInfoButtonNode=e.querySelector(I)}mount(){this.addEventListeners()}unmount(){this.removeEventListeners()}addEventListeners(){this.anchorNode.addEventListener(k,this),this.removeButtonNode&&this.removeButtonNode.addEventListener(k,this),this.rewriteButtonNode&&this.rewriteButtonNode.addEventListener(k,this),this.showDSAInfoButtonNode&&this.showDSAInfoButtonNode.addEventListener(k,this)}removeEventListeners(){this.anchorNode.removeEventListener(k,this),this.removeButtonNode&&this.removeButtonNode.removeEventListener(k,this),this.rewriteButtonNode&&this.rewriteButtonNode.removeEventListener(k,this),this.showDSAInfoButtonNode&&this.showDSAInfoButtonNode.removeEventListener(k,this)}handleEvent(e){e.preventDefault(),e.stopPropagation(),e.currentTarget===this.anchorNode&&this.onItemClick(),e.currentTarget===this.removeButtonNode&&this.onRemoveButtonClick(),e.currentTarget===this.rewriteButtonNode&&this.onRewriteButtonClick(),e.currentTarget===this.showDSAInfoButtonNode&&this.onShowDSAInfoButtonClick(e)}onItemClick(){this.emitter.emit(R,this.component)}onRemoveButtonClick(){this.emitter.emit(j,this.component,this.store.inputPhrase)}onRewriteButtonClick(){this.emitter.emit(B,this.component,this.store.inputPhrase)}onShowDSAInfoButtonClick(e){e.stopPropagation(),(e=>{const{tracking:t}=e,{dsaId:s}=t||{};(e=>{window.opbox.plugin.get("xd").then((({showModal:t})=>t([e]))).catch((e=>{window.opbox.reportError(e)}))})(s)})(this.component)}markActive(){this.anchorNode.setAttribute(Si,"true"),vt(this.store,this.component.completionText||"")}markInactive(){this.anchorNode.removeAttribute(Si)}}const Ei="aria-expanded",yi=[Ye,Ze,Je,"WAREHOUSE",Xe,st],bi=[Ye,Ze,st],Li=[Xe],Ni=[et,tt,st,it];function fi(e){switch(e){case et:return"sellers";case it:return"charity-organizations";case tt:case st:return"fundraising-campaigns";default:return"all"}}class wi{constructor(e,i,r,n,o=D(),a=window){var h=this;this.suggesterNode=void 0,this.isExpanded=!1,this.suggestionItems=[],this.advancedSearchCriteriaItems=[],this.stateUnbinders=[],this.suggesterUnbinders=[],this.searchInputUnbinders=[],this.onStateSuggestions=()=>{this.render()},this.onSearchInputBlur=()=>{this.store.activeSuggestionIndex=-1},this.onSearchInputClear=()=>{this.fetch()},this.onSearchInputClick=()=>{this.isExpanded||this.fetch()},this.onSearchInput=e=>{this.fetch(e)},this.onSearchInputTabPress=()=>{this.destroy()},this.onSearchInputEscapePress=()=>{this.destroy()},this.onSearchInputArrowUpPress=()=>{this.markPreviousSuggestion()},this.onSearchInputArrowDownPress=()=>{this.markNextSuggestion()},this.onSearchInputDeletePress=()=>{if(-1===this.store.activeSuggestionIndex)return;const e=this.store.suggestions.filter(s)[this.store.activeSuggestionIndex];t(e)||this.deleteSuggestion(e)},this.fetch=async(e=h.store.inputPhrase)=>{if(rt(nt,h.store,h.props)||((e,t)=>!t.enableSuggestionsForEmptyPhrase&&(e=>""===e)(e))(e,h.props))return Promise.resolve();const t=Object.assign(Object.assign({query:e},h.props.enableSuggesterHistory?{history:!0}:{}),((e,t)=>{const s=t.filters.list[e.selectedFilterIndex];if(!q(s))return{};const{type:i,id:r,name:n}=s,o=yi.includes(i),a=bi.includes(i),h=Li.includes(i),c=Ni.includes(i);let d;switch(i){case"CHARITY_ORGANIZATION":d="charity-organization";break;case"DEPARTMENT":d="category";break;default:d=i.toLowerCase()}return Object.assign(Object.assign(Object.assign(Object.assign({},o?{scope:d}:{}),a?{"scope-value":r}:{}),h?{"scope-value":n}:{}),c?{types:fi(i)}:{})})(h.store,h.props));return(async(e,t=li())=>{mi.abort(),mi=new AbortController;const s=mi.signal;try{return await t.get("/search-suggester/suggestions?"+(i=e,Object.entries(i).map((([e,t])=>Vt({key:e,value:t}))).join("&")),{withCredentials:!0,signal:mi.signal,headers:{accept:"application/vnd.allegro.internal.v7+json"}})}catch(r){if(s.aborted)throw new gi;throw r}var i})(t).then((({status:t,data:{suggestions:s,tracking:i}})=>{h.store.tracking=i,h.store.suggestions=s,h.store.activeSuggestionIndex=-1,h.emitter.emit(T,t,e)})).catch((t=>{t instanceof gi||(h.store.tracking={},h.store.suggestions=[],h.store.activeSuggestionIndex=-1,h.emitter.emit(T,t&&t.status||t,e))}))},this.onToggleExpanded=e=>{this.isExpanded=e},this.onClickSuggestion=e=>{const[t,s]=ht(this.props.advancedSearchCriterias,this.store.checkedAdvancedSearchCriteriaIds),i=[...t,...this.props.staticQueryParameters],r=Qt(e.url,this.props.listingPathname,i,s);this.targetWindow.document.location.assign(r)},this.onClickHorizontalList=e=>{this.targetWindow.document.location.assign(e.items[0].url)},this.onClickRewriteSuggestion=e=>{this.fetch(e.completionText),vt(this.store,e.completionText||"")},this.onClickRemoveSuggestion=e=>{this.deleteSuggestion(e)},this.deleteSuggestion=({history:{removable:e,id:t}})=>{e&&t&&((e,t=li())=>t.delete("/search-history/"+e,{withCredentials:!0,disableDefaultHeaders:!0}))(t).then((({status:e})=>{e>=200&&e<300&&this.fetch()})).catch(Function.prototype)},this.baseNode=e,this.store=i,this.props=r,this.searchInput=n,this.emitter=o,this.targetWindow=a,this.suggesterNode=e.querySelector(L)}mount(){this.addStateListeners(),this.addSuggesterListeners(),this.addSearchInputListeners()}unmount(){this.removeStateListeners(),this.removeSuggesterListeners(),this.removeSearchInputListeners(),this.removeGlobalEventListeners()}onUpdate({inputPhrase:e="",advancedSearchCriterias:t=[]}){""===e&&this.destroy(),St(this.store,t.filter((e=>this.props.advancedSearchCriterias.map((e=>e.id)).includes(e.id))).filter((({checked:e})=>e)).map((({id:e})=>e)))}addStateListeners(){this.stateUnbinders.push(this.store.on(F.Suggestions,this.onStateSuggestions))}addSuggesterListeners(){this.suggesterUnbinders.push(this.emitter.on(O,this.onToggleExpanded),this.emitter.on(R,this.onClickSuggestion),this.emitter.on(U,this.onClickHorizontalList),this.emitter.on(B,this.onClickRewriteSuggestion),this.emitter.on(j,this.onClickRemoveSuggestion))}addSearchInputListeners(){this.searchInputUnbinders.push(this.searchInput.emitter.on(Jt,this.onSearchInputBlur),this.searchInput.emitter.on(Xt,this.onSearchInputClear),this.searchInput.emitter.on(es,this.onSearchInputClick),this.searchInput.emitter.on(ts,this.onSearchInput),this.searchInput.emitter.on(os,this.onSearchInputTabPress),this.searchInput.emitter.on(rs,this.onSearchInputEscapePress),this.searchInput.emitter.on(is,this.onSearchInputArrowUpPress),this.searchInput.emitter.on(ss,this.onSearchInputArrowDownPress),this.searchInput.emitter.on(ns,this.onSearchInputDeletePress))}addGlobalEventListeners(){this.targetWindow.addEventListener(k,this)}removeGlobalEventListeners(){this.targetWindow.removeEventListener(k,this)}removeStateListeners(){this.stateUnbinders.forEach((e=>e()))}removeSuggesterListeners(){this.suggesterUnbinders.forEach((e=>e()))}removeSearchInputListeners(){this.searchInputUnbinders.forEach((e=>e()))}handleEvent(e){e.type===k&&this.onGlobalClick(e)}render(){var e,t;this.unmountSuggestions(),this.unmountAdvancedSearchCriteria(),this.suggesterNode.innerHTML=(e=this.props,t=this.store,((e,t=",")=>e.length?new ft(["",...Array(e.length-1).fill(t),""],e):"")([...t.suggestions.map((t=>((e,t)=>{switch(e.type){case"DIVIDER":return wt(ni||(ni=di`<div class="${0}"><hr class="${0}" /><span class="${0}">lub</span><hr class="${0}" /></div>`),Rs,Us,Bs,Us);case"LABEL":return(({view:{labelItems:e}})=>wt(oi||(oi=di`<div data-role="${0}" class="${0}"><div class="${0}">${0}</div></div>`),"label",As,$s,e.map(Vs)))(e);case"SUGGESTION":return((e,t)=>{const{url:s,view:i,tracking:a}=e,{image:h}=i,c=!!h,d=c&&"AUTO"!==h.size,u=c&&"LARGE"===h.size?"_535b5_70jzr":"_535b5_5HBqT",{type:l,dsaId:m}=a||{},g=e=>e.length?wt(ai||(ai=di`<div class="${0}">${0}</div>`),Qe,e.map(Vs)):"",p="PREMIUMAD"===l&&m?ri:g,v=c?wt(hi||(hi=di`<img alt="" src="${0}" class="${0}" />`),h.url,bs("m3h2_8",{[u]:d})):"";return wt(ci||(ci=di`<a role="option" href="${0}" class="${0}" data-role="${0}">${0} ${0}<div class="${0}">${0} ${0}</div></a>`),s,bs(Cs,xs),o,v,(({history:e,completionText:t},s)=>{return e.removable?(i=s.enableSuggestionRemovalButtonOnHover,Ys({icon:"https://a.allegroimg.com/original/34f3f5/bf439aab49d0a78bcd7501d51697/action-common-x-6c70096572",buttonClassName:bs(fs,i&&_s),iconClassName:ks,dataRole:r})):t&&s.enableRewriteSuggestionButton?Ys({icon:"https://a.allegroimg.com/original/3469d1/e5baae674c14b193801643097f91/action-common-arrow-1d58018082",iconClassName:ws,buttonClassName:fs,dataRole:n}):"";var i})(e,t),Ps,g(i.labelItems),i.subLabelItems?p(i.subLabelItems):"")})(e,t);case"HORIZONTAL_LIST":return(e=>{const t=e.items.map((e=>{let t="";switch(e.view.type){case"IMAGE":t=(e=>wt(Zs||(Zs=si`<img class="${0}" style="aspect-ratio:${0}" src="${0}" alt="" />`),"mse2_24",e.aspect,e.url))(e.view);break;case"TEXT":t=Vs(e.view);break;default:return""}return wt(Js||(Js=si`<a role="option" class="${0}" href="${0}">${0}</a>`),Fs,e.url,t)}));return wt(Xs||(Xs=si`<div data-role="${0}" class="${0}">${0}<div class="${0}">${0}</div></div>`),a,js,Vs(e.label),Ds,t)})(e);default:return""}})(t,e))),...Es(e,t)],"")).toString(),this.mountSuggestions(),this.mountAdvancedSearchCriteria(),this.markSuggesterAccordingly()}destroy(){this.unmountSuggestions(),this.unmountAdvancedSearchCriteria(),this.markSuggesterInactive(),this.suggesterNode.innerHTML=""}markSuggestionByStepOf(e){const{length:t}=this.suggestionItems;if(0===t)return;const{activeSuggestionIndex:s}=this.store,i=((Math.max(s,1===e?-1:0)+e)%t+t)%t;var r;this.toggleActiveSuggestions(s,i),r=this.store,gt(r,F.ActiveSuggestionIndex,i)}markPreviousSuggestion(){this.markSuggestionByStepOf(-1)}markNextSuggestion(){this.markSuggestionByStepOf(1)}toggleActiveSuggestions(e,t){-1!==e&&this.suggestionItems[e].markInactive(),this.suggestionItems[t].markActive()}mountSuggestions(){const e=this.suggesterNode.childNodes;Array.from(e).filter((e=>"A"===e.nodeName||e.dataset.role===a)).forEach(((e,t)=>{const i=this.store.suggestions.filter(s)[t];let r=null;"HORIZONTAL_LIST"===i.type&&(r=new vi(e,this.store,i,this.emitter)),"SUGGESTION"===i.type&&(r=new Ii(e,this.store,i,this.emitter)),r&&(r.mount(),this.suggestionItems.push(r))}))}mountAdvancedSearchCriteria(){this.suggesterNode.querySelectorAll(d).forEach(((e,t)=>{const s=new ui(e,this.props.advancedSearchCriterias[t].id,this.store);s.mount(),this.advancedSearchCriteriaItems.push(s)}))}unmountSuggestions(){this.suggestionItems.forEach((e=>e.unmount())),this.suggestionItems=[]}unmountAdvancedSearchCriteria(){this.advancedSearchCriteriaItems.forEach((e=>e.unmount())),this.advancedSearchCriteriaItems=[]}markSuggesterAccordingly(){0===this.store.suggestions.length&&at(this.store,this.props)?this.markSuggesterInactive():this.isExpanded||this.markSuggesterActive()}markSuggesterActive(){this.suggesterNode.setAttribute(Ei,"true"),this.emitter.emit(O,!0,this.store.inputPhrase),this.addGlobalEventListeners()}markSuggesterInactive(){this.suggesterNode.setAttribute(Ei,"false"),this.emitter.emit(O,!1,this.store.inputPhrase),this.removeGlobalEventListeners()}onGlobalClick(e){this.isExpanded&&null===e.target.closest([L,b,p,E].join(","))&&this.destroy()}}const ki="opbox-search-history";class _i{constructor(t,i,r,n=window.localStorage){this.searchFormNode=void 0,this.suggesterUnbinders=[],this.onSubmit=()=>{const{activeSuggestionIndex:t,suggestions:i}=this.store;if(-1===t)this.saveEntryFromStore();else{const r=i.filter(s)[t];e(r)&&this.saveEntryFromSuggestion(r)}},this.onSuggesterClickSuggestion=e=>{this.saveEntryFromSuggestion(e)},this.getFilterScopeData=()=>{const e=this.props.filters.list[this.store.selectedFilterIndex];return{scope:"DEPARTMENT"===e.type?"CATEGORY":e.type,scopeValue:e.type===Xe?e.name:e.id}},this.saveEntryFromSuggestion=e=>{const{action:t}=e;if(!e.history.save||!t)return;const s=Object.assign({action:t,userQuery:null,id:e.history.id},this.getFilterScopeData());this.saveEntry(s)},this.baseNode=t,this.store=i,this.props=r,this.localStorage=n,this.searchFormNode=t.querySelector(y)}mount(e){this.postHistoryEntry(),this.addEventListeners(),this.addSuggesterListeners(e)}unmount(){this.removeEventListeners(),this.removeSuggesterListeners()}addSuggesterListeners(e){this.suggesterUnbinders.push(e.on(R,this.onSuggesterClickSuggestion))}addEventListeners(){this.searchFormNode.addEventListener(P,this)}removeSuggesterListeners(){this.suggesterUnbinders.forEach((e=>e()))}removeEventListeners(){this.searchFormNode.removeEventListener(P,this)}handleEvent(e){e.type===P&&this.onSubmit()}saveEntryFromStore(){const e=Object.assign({userQuery:this.store.inputPhrase},this.getFilterScopeData());this.saveEntry(e)}saveEntry(e){e.scope&&(e.action||e.userQuery)&&this.localStorage.setItem(ki,JSON.stringify(e))}getEntry(){return JSON.parse(this.localStorage.getItem(ki)||"null")}removeEntry(){this.localStorage.removeItem(ki)}postHistoryEntry(){const e=this.getEntry();e&&((e,t=li())=>t.post("/search-history",e,{withCredentials:!0,headers:{"content-type":"application/vnd.allegro.internal.v2+json"}}))(e).then((()=>this.removeEntry()))}}const Ci="mj6k_96 "+Be+" mvrt_24_l",Ai=we+" "+De+" _535b5_ujp-s";class xi{constructor(e,t,s,i=window){this.logoWrapperNode=void 0,this.suggesterNode=void 0,this.multiSearchNode=void 0,this.visualSearchNode=void 0,this.removeQueryNode=void 0,this.searchInputUnbinders=[],this.suggesterUnbinders=[],this.timeoutId=0,this.addGlobalEventListeners=()=>{this.targetWindow.addEventListener(k,this)},this.addSuggesterListeners=e=>{this.suggesterUnbinders.push(e.on(O,this.onSuggesterToggleIsExpanded))},this.removeGlobalEventListeners=()=>{this.targetWindow.removeEventListener(k,this)},this.onSuggesterToggleIsExpanded=e=>{e?this.addGlobalEventListeners():this.removeGlobalEventListeners()},this.onSearchInputClick=()=>{this.targetWindow.clearTimeout(this.timeoutId),this.hideLogo(),this.timeoutId=setTimeout((()=>{this.showSuggester(),this.showMultiSearch(),this.showVisualSearch(),this.showRemoveQuery()}),200)},this.showLogo=()=>{ct(this.logoWrapperNode,!1,[...Ai.split(" ")]),ct(this.logoWrapperNode,!0,[...Ci.split(" ")])},this.hideLogo=()=>{ct(this.logoWrapperNode,!0,[...Ai.split(" ")]),ct(this.logoWrapperNode,!1,[...Ci.split(" ")])},this.showSuggester=()=>{dt(this.suggesterNode,!0)},this.hideSuggester=()=>{dt(this.suggesterNode,!1)},this.showMultiSearch=()=>{this.multiSearchNode&&!this.store.inputPhrase&&ut(this.multiSearchNode,!0)},this.hideMultiSearch=()=>{this.multiSearchNode&&ut(this.multiSearchNode,!1)},this.showVisualSearch=()=>{this.visualSearchNode&&!this.store.inputPhrase&&ut(this.visualSearchNode,!0)},this.hideVisualSearch=()=>{this.visualSearchNode&&ut(this.visualSearchNode,!1)},this.showRemoveQuery=()=>{this.store.inputPhrase&&this.removeQueryNode&&ut(this.removeQueryNode,!0)},this.hideRemoveQuery=()=>{this.removeQueryNode&&ut(this.removeQueryNode,!1)},this.baseNode=e,this.store=t,this.searchInput=s,this.targetWindow=i,this.logoWrapperNode=e.querySelector(m),this.suggesterNode=e.querySelector(L),this.multiSearchNode=e.querySelector(g),this.visualSearchNode=e.querySelector(N),this.removeQueryNode=e.querySelector(p)}mount(e){this.addSearchInputListeners(),this.addSuggesterListeners(e),this.hideSuggester()}unmount(){this.removeSearchInputListeners(),this.removeSuggesterListeners(),this.removeGlobalEventListeners()}addSearchInputListeners(){this.searchInputUnbinders.push(this.searchInput.emitter.on(es,this.onSearchInputClick))}removeSearchInputListeners(){this.searchInputUnbinders.forEach((e=>e()))}removeSuggesterListeners(){this.suggesterUnbinders.forEach((e=>e()))}handleEvent(e){e.type===k&&this.onGlobalClick(e)}onGlobalClick(e){null===e.target.closest([L,b,p,E].join(","))&&(this.targetWindow.clearTimeout(this.timeoutId),this.showLogo(),this.hideSuggester(),this.hideMultiSearch(),this.hideVisualSearch(),this.hideRemoveQuery())}}window.opbox.component.register({prototypeName:"allegro.metrumHeader.search",clientImplementationVersion:"b6c"},class{constructor({baseNode:e,props:t}){this.baseNode=void 0,this.props=void 0,this.store=void 0,this.searchInput=void 0,this.searchForm=void 0,this.suggester=void 0,this.filters=void 0,this.history=void 0,this.logo=void 0,this.analyticsDispatcher=void 0,this.onUpdate=e=>{this.searchInput.onUpdate(e),this.suggester.onUpdate(e)},this.baseNode=e,this.props=t,this.store=new z(t),this.searchInput=new as(e,this.store),this.searchForm=new Zt(e,this.store,t),this.suggester=new wi(e,this.store,t,this.searchInput),this.filters=new Gt(e,this.store,t),t.enableSuggesterHistory&&(this.history=new _i(e,this.store,t)),t.enableLogo&&(this.logo=new xi(e,this.store,this.searchInput)),this.analyticsDispatcher=new yt(e,this.store,t)}onMount(){this.analyticsDispatcher.mount(this.suggester.emitter),this.props.enableSuggesterHistory&&this.history.mount(this.suggester.emitter),this.props.enableLogo&&this.logo.mount(this.suggester.emitter),this.searchInput.mount(this.suggester.emitter),this.searchForm.mount(),this.filters.mount(),this.suggester.mount()}onUnmount(){this.analyticsDispatcher.unmount(),this.props.enableSuggesterHistory&&this.history.unmount(),this.props.enableLogo&&this.logo.unmount(),this.searchInput.unmount(),this.searchForm.unmount(),this.filters.unmount(),this.suggester.unmount()}});
//# sourceMappingURL=index.es6-pl-PL_6c235abb.js.map