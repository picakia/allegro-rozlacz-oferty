const e="serviceWorker";function r(){return"serviceWorker"in window.navigator}function n(){if(!r())return Promise.reject();try{return window.navigator.serviceWorker.register("/service-worker.js").then((()=>window.navigator.serviceWorker.ready)).catch((e=>(window.opbox.plugin.get("sentry").then((r=>r.captureException(e))).catch((()=>{console.error(e)})),Promise.reject())))}catch(e){return Promise.reject()}}function i(){if(!r())return Promise.resolve(void 0);try{return window.navigator.serviceWorker.getRegistration()}catch(e){return Promise.resolve(void 0)}}const t={headers:{Accept:"application/vnd.allegro.public.v1+json","Content-Type":"application/json"},withCredentials:!0};function o(){return r()&&"PushManager"in window}function s(e){return null!==e}function c(e){return void 0===e?Promise.resolve(null):e.pushManager.getSubscription()}function a(e){return void 0===e?Promise.reject():c(e).then((e=>s(e)?e.unsubscribe().then((()=>e.endpoint)):Promise.reject()))}function u(e){const{endpoint:r,keys:{auth:n,p256dh:i}={}}=e.toJSON();return window.opbox.edge.post("/notifications/subscriptions",{endpoint:r,auth:n,p256dh:i},t)}function p(e){return window.opbox.edge.post("/notifications/subscriptions/remove",{endpoint:e},t)}const l=()=>i().then(c).then(s).catch((()=>!1)),h=()=>i().then(a).then(p),d=()=>Promise.resolve(o()),{serviceWorkerConfiguration:w,applicationServerKey:b}=(({pluginName:e,clientImplementationVersion:r})=>{try{return JSON.parse(window.document.querySelector(`script[data-serialize-plugin-name="${e}"][data-civ="${r}"]`).textContent)}catch(n){return window.opbox.reportError(Error(`Missing serialized props of plugin "${e}", with civ "${r}"`)),{}}})({pluginName:e,clientImplementationVersion:"20c"});w&&w.enabled&&b&&window.opbox.plugin.register({name:e},new class{constructor({applicationServerKey:e}){this.applicationServerKey=void 0,this.subscribeToWebPush=()=>(o()?new Promise(((e,r)=>{const n=Notification.requestPermission((r=>{e(r)}));n&&n.then(e,r)})).then((e=>{if("granted"!==e)throw Error("Permission not granted.")})):Promise.reject()).then(n).then((e=>((e,r)=>{const n={userVisibleOnly:!0,applicationServerKey:this.applicationServerKey};return e.pushManager.subscribe(n)})(e))).then(u),this.getPublicApi=()=>({isSubscribedToWebPush:l,unsubscribeFromWebPush:h,isWebPushSupported:d,subscribeToWebPush:this.subscribeToWebPush}),this.applicationServerKey=(e=>{const r=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),n=window.atob(r),i=new Uint8Array(n.length);for(let t=0;t<n.length;t+=1)i[t]=n.charCodeAt(t);return i})(e)}}({window,applicationServerKey:b}).getPublicApi()),i().then((e=>{e&&"function"==typeof window.cm&&window.cm("send","event",{category:"Performance",label:"ServiceWorkerRegistered"})}));
//# sourceMappingURL=index.es6_f57f984d.js.map