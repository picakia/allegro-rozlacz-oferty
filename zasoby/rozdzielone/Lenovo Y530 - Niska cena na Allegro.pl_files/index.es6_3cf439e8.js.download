var e=[e=>{e.exports={SlotEventType:{ON_RENDER:0,ON_VIEW:1}}}],t={};function i(s){var o=t[s];if(void 0!==o)return o.exports;var r=t[s]={exports:{}};return e[s](r,r.exports,i),r.exports}(()=>{const e="b84";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e=>typeof e:e=>e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e,t(e)}function s(e,i,s){return(i=(e=>{var i=((e,i)=>{if("object"!==t(e)||null===e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var o=s.call(e,"string");if("object"!==t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return e+""})(e);return"symbol"===t(i)?i:i+""})(i))in e?Object.defineProperty(e,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[i]=s,e}var o=i(0);const r="@allegro/opbox-googletag-service";let n=(e=>(e[e.BANNER=0]="BANNER",e[e.SKYSCROLL=1]="SKYSCROLL",e[e.PARALLAX=2]="PARALLAX",e[e.UNDER_PRICE=3]="UNDER_PRICE",e[e.GDPR_MESSAGE=4]="GDPR_MESSAGE",e))({});function a(e){const{path:t}=e||{};return t&&0!==t.length?t.map((e=>e.id)).filter((e=>e.length<=20)).join("_"):""}function l(e){return"BOUGHT"===e.status}function d(e){if(!e)return;const t=[];return e.orders.filter(l).forEach((e=>{e.offers.forEach((e=>{const i=(e=>{var t;return null===(t=e.assortmentCategory)||void 0===t?void 0:t.path.reduce(((e,{id:t})=>`${e}${e?"_":""}${t}`),"")})(e);i&&t.push(i)}))})),t}const h=e=>{const[t,i]=e.split("x");return[+t,+i]};function p(e){var t,i;return{viewport:e.viewport,sizes:null!==(t=null===(i=e.sizes)||void 0===i?void 0:i.map(h))&&void 0!==t?t:[]}}function c(e){var t,i;return null!==(t=null==e||null===(i=e.traits)||void 0===i?void 0:i.map((e=>`${e.hash}_${e.value}`)))&&void 0!==t?t:[]}function v(e){return e.reduce(((e,t)=>{return[...e,...(i=e,s=t.sizes,s.filter((([e,t])=>!i.some((([i,s])=>e===i&&t===s)))))];var i,s}),[])}function g(e,t){window.opbox.analytics.sendEvent({contextNode:e,action:"itemView",customParams:t.getResponseInformation()})}let u=!1;class f{constructor({rawUserTraits:e,tagId:t,services:i,responsiveMappings:o,targetingProps:n}){s(this,"services",void 0),s(this,"tagId",void 0),s(this,"responsiveMappings",void 0),s(this,"targetingProps",void 0),s(this,"slot",null),s(this,"setupOnClickEvent",(()=>{window.addEventListener("blur",(()=>setTimeout(this.handleWindowBlur,0)))})),s(this,"getGoogletagService",(()=>(this.blockGdprMessage(),this.services.get(r)))),s(this,"applySlotConfiguration",(e=>{((e,t)=>{const i=googletag.sizeMapping();t.forEach((({viewport:e,sizes:t})=>{i.addSize([e.width,e.height],t)})),e.defineSizeMapping(i.build())})(e,this.responsiveMappings),this.setTargeting(e)})),s(this,"handleWindowBlur",(()=>{var e,t;this.slotWasClicked()&&(e=this.adNode,t=this.slot,e&&window.opbox.analytics.sendEvent({contextNode:e,action:"click",customParams:null==t?void 0:t.getResponseInformation()}))})),this.services=i,this.tagId=t,this.responsiveMappings=o,this.targetingProps=n,this.setupOnClickEvent(),(e=>{if(u||!e)return;const t={profile:{profile:{traits:(e=>Object.fromEntries(e.map((({hash:e,value:t})=>[e,t]))))(e.traits)}},lastUpdate:new Date};localStorage.setItem("pl_allegro_user_profile",JSON.stringify(t)),u=!0})(e)}refresh(e=!1){this.getGoogletagService().then((t=>{e&&(this.adNode.style.position="static"),t.refreshSlot(this.tagId)}))}setTargeting(e){this.setQueryParametersTargeting(e);const{userTraits:t,erotic:i,categoryPath:s,offerId:o,sellerId:r,ordersCategoryPaths:n,offerImage:a,offerPrice:l,offerTitle:d}=this.targetingProps;e.setTargeting("profil",t),s.length>0&&e.setTargeting("cat",s),"boolean"==typeof i&&e.setTargeting("ertc",i?"1":"0"),o&&e.setTargeting("offerId",o),r&&e.setTargeting("sellerId",r),a&&e.setTargeting("offerImage",a),n&&e.setTargeting("cat",n),l&&e.setTargeting("offerPrice",l),d&&e.setTargeting("offerTitle",d)}slotWasClicked(){var e;const{activeElement:t}=window.document,i=null===(e=this.adNode)||void 0===e?void 0:e.querySelector("iframe");return"IFRAME"===(null==t?void 0:t.nodeName)&&t===i}setQueryParametersTargeting(e){const t=(()=>{const e=new URL(window.location.href);return[...new Set(e.searchParams.keys())].map((t=>{const i=e.searchParams.getAll(t);return[t,1===i.length?i[0]:i]}))})();t&&t.forEach((([t,i])=>e.setTargeting("q_"+t,i)))}blockGdprMessage(){window.googlefc=window.googlefc||{},window.googlefc.controlledMessagingFunction=async e=>{e.proceed(!1)}}}function y(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((t=>Object.getOwnPropertyDescriptor(e,t).enumerable))),i.push.apply(i,s)}return i}function m(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?y(Object(i),!0).forEach((t=>{s(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):y(Object(i)).forEach((t=>{Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}const S=(e,t,i)=>{let s={userTraits:t.userTraits,categoryPath:t.categoryPath};return i.forEach((e=>{t[e]&&(s=m(m({},s),{},{[e]:t[e]}))})),{rawUserTraits:t.rawUserTraits,tagId:t.tagId,responsiveMappings:t.responsiveMappings,services:e,targetingProps:s}},b="mpof_5r",w="mpof_ki",E=b,I=w;class N{constructor(e,t,i){s(this,"parentNode",void 0),s(this,"bodyNode",void 0),s(this,"sticky",!1),s(this,"footerVisible",!1),s(this,"resizeObserverSupported",void 0),s(this,"viewportDesktop",void 0),s(this,"resizeObserver",null),s(this,"footerObserver",null),s(this,"scheduledFrame",null),s(this,"handleStickiness",(()=>{const e=this.parentNode.getBoundingClientRect().y-61;e<=0&&!this.sticky&&!this.footerVisible?this.setSticky():(e>0||this.footerVisible)&&this.sticky&&this.unsetSticky(),this.scheduledFrame=null})),s(this,"handleWindowScroll",(()=>{this.scheduledFrame||(this.scheduledFrame=window.requestAnimationFrame(this.handleStickiness))})),s(this,"handleFooterVisibilityInViewport",(e=>{e.forEach((e=>{e.isIntersecting?(this.footerVisible=!0,this.unsetStickyStyles()):(this.footerVisible=!1,this.sticky&&this.setStickyStyles())}))})),s(this,"handleWindowResize",(e=>{e.forEach((e=>{e.contentRect.width<1024&&this.sticky&&(this.unsetSticky(),this.disconnectObservers())}))})),this.node=e,this.footerNode=t,this.classList=i,this.bodyNode=document.body,this.parentNode=this.node.parentElement,this.resizeObserverSupported="ResizeObserver"in window,this.viewportDesktop=document.documentElement.clientWidth>=1024}initialize(){this.viewportDesktop&&this.resizeObserverSupported&&this.registerObservers()}setSticky(){this.setStickyStyles(),this.sticky=!0}unsetSticky(){this.unsetStickyStyles(),this.sticky=!1}registerObservers(){this.resizeObserver=new ResizeObserver(this.handleWindowResize),this.footerObserver=new IntersectionObserver(this.handleFooterVisibilityInViewport)}connectObservers(){var e,t;null===(e=this.resizeObserver)||void 0===e||e.observe(this.bodyNode),null===(t=this.footerObserver)||void 0===t||t.observe(this.footerNode),window.addEventListener("scroll",this.handleWindowScroll)}disconnectObservers(){var e,t;null===(e=this.resizeObserver)||void 0===e||e.disconnect(),null===(t=this.footerObserver)||void 0===t||t.disconnect(),window.removeEventListener("scroll",this.handleWindowScroll)}setStickyStyles(){this.node.classList.add(...this.classList)}unsetStickyStyles(){this.node.classList.remove(...this.classList)}}const z=["responsiveMappings","categoryData","userTraits"],O=b,T=w;function P(e){var t,i,s,o,r,n,a,l,d,h,p;const{buyNow:c,advertisement:v,auction:g}=e;return null!==(t=null!==(i=null!==(s=null!==(o=null==c||null===(r=c.price)||void 0===r||null===(n=r.original)||void 0===n?void 0:n.amount)&&void 0!==o?o:null==c||null===(a=c.price)||void 0===a||null===(l=a.sale)||void 0===l?void 0:l.amount)&&void 0!==s?s:null==v||null===(d=v.price)||void 0===d?void 0:d.amount)&&void 0!==i?i:null==g||null===(h=g.price)||void 0===h||null===(p=h.current)||void 0===p?void 0:p.amount)&&void 0!==t?t:null}window.opbox.component.register({prototypeName:"allegro.advertisement.slot.banner",clientImplementationVersion:e},class extends f{constructor({services:e,props:t}){super(S(e,t,["erotic","ordersCategoryPaths","offerId","sellerId"])),s(this,"props",void 0),s(this,"initialized",!1),s(this,"adNode",void 0),s(this,"onEvent",(e=>{const{scaleToFitContainer:t}=this.props;switch(e.type){case o.SlotEventType.ON_RENDER:{const i=e.event.size;this.slot=e.event.slot,this.applyAdHeight(i),t&&i&&this.scaleToFitContainer(i);break}case o.SlotEventType.ON_VIEW:g(this.adNode,e.event.slot)}})),this.props=t;const i=document.getElementById(t.tagId);if(!i)throw Error("Couldn't find the ad node");this.adNode=i}onMount(){this.props.visible&&this.initialize()}onUnmount(){this.initialized&&this.destroy()}onUpdate(e){this.props=((e,{unitPath:t,responsiveMappings:i,alignment:s,erotic:o,scaleToFitContainer:r,visible:l,marginBottom:h,userTraits:v,categoryData:g,reserveSpace:u,orders:f,offerId:y,sellerId:m})=>({type:n.BANNER,tagId:e,unitPath:t,responsiveMappings:i.map(p),alignment:s,erotic:o,scaleToFitContainer:r,visible:l,marginBottom:h,userTraits:c(v),rawUserTraits:v,reserveSpace:u,categoryPath:a(g),ordersCategoryPaths:d(f),offerId:y,sellerId:m}))(this.props.tagId,e),this.props.visible?(!this.initialized&&this.initialize(),this.initialized&&this.refresh()):this.initialized&&this.destroy()}initialize(){const{tagId:e,unitPath:t,responsiveMappings:i,reserveSpace:s}=this.props,{clientWidth:o,clientHeight:r}=document.documentElement,n=((e,t,i)=>i.reverse().find((({viewport:i})=>i.height<=t&&i.width<=e)))(o,r,i);s||n&&0!==n.sizes.length?(this.getGoogletagService().then((s=>{s.defineSlot({tagId:e,unitPath:t,size:v(i),slotConfigurationCallback:this.applySlotConfiguration,onEvent:this.onEvent})})),this.show(),this.initialized=!0):this.hide()}destroy(){this.hide(),this.getGoogletagService().then((e=>{e.destroySlot(this.props.tagId),this.adNode.innerHTML=""})),this.initialized=!1}show(){var e,t;null===(e=this.adNode.parentElement)||void 0===e||null===(t=e.classList)||void 0===t||t.replace(E,I)}hide(){var e,t;null===(e=this.adNode.parentElement)||void 0===e||null===(t=e.classList)||void 0===t||t.replace(I,E)}applyAdHeight(e){const{parentElement:t}=this.adNode;if(!t||!e)return;const[,i]=e;(parseInt(t.style.height,10)||0)<i&&(t.style.height=i+"px",t.style.overflow="visible")}scaleToFitContainer([e,t]){var i;const{parentElement:s}=this.adNode;if(!s)return;const o=(null!==(i=s.offsetWidth)&&void 0!==i?i:0)-e;if(o<0){const i=(e+o)/e,r=i*t;this.adNode.style.transform=`scale(${i})`,s.style.height=r+"px",s.style.alignItems="center"}}}),window.opbox.component.register({prototypeName:"allegro.advertisement.slot.skyscroll",clientImplementationVersion:e},class extends f{constructor({services:e,props:t,baseNode:i}){super(S(e,t,["erotic"])),s(this,"props",void 0),s(this,"baseNode",void 0),s(this,"stickyBehaviour",void 0),s(this,"initialized",!1),s(this,"adNode",void 0),s(this,"onEvent",(e=>{e.type===o.SlotEventType.ON_VIEW&&g(this.adNode,e.event.slot),e.type===o.SlotEventType.ON_RENDER&&(this.slot=e.event.slot)})),this.props=t;const r=document.getElementById(t.tagId);if(!r)throw Error("Couldn't find the ad node");this.adNode=r,this.baseNode=i;const n=document.querySelector('.site-footer,[data-box-name="metrum-footer-partial"],[data-box-name="layout.container.footer"]');n?(this.stickyBehaviour=new N(this.adNode,n,["_d0a4b_ZcoIh","mp7g_oz"]),this.stickyBehaviour.initialize()):(window.opbox.reportError(Error("Couldn't find the footer. It does not exist on page or selector has changed.")),this.stickyBehaviour=null)}onMount(){this.props.visible&&this.initializeSlot()}onUnmount(){this.initialized&&this.destroySlot()}beforeOnUpdate(){var e;null===(e=this.stickyBehaviour)||void 0===e||e.unsetSticky()}onUpdate(e){this.props=((e,t)=>{let{responsiveMappings:i,categoryData:s,userTraits:o}=t;return m(m({},((e,t)=>{if(null==e)return{};var i,s,o=((e,t)=>{if(null==e)return{};var i,s,o={},r=Object.keys(e);for(s=0;s<r.length;s++)i=r[s],t.indexOf(i)>=0||(o[i]=e[i]);return o})(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(s=0;s<r.length;s++)i=r[s],t.indexOf(i)>=0||{}.propertyIsEnumerable.call(e,i)&&(o[i]=e[i])}return o})(t,z)),{},{type:n.SKYSCROLL,tagId:e,responsiveMappings:i.map(p),categoryPath:a(s),userTraits:c(o),rawUserTraits:o})})(this.props.tagId,e),this.props.visible?(!this.initialized&&this.initializeSlot(),this.initialized&&this.refreshSlot()):this.initialized&&this.destroySlot()}initializeSlot(){const{tagId:e,unitPath:t}=this.props;this.getGoogletagService().then((i=>{i.defineSlot({tagId:e,unitPath:t,size:v(this.props.responsiveMappings),slotConfigurationCallback:this.applySlotConfiguration,onEvent:this.onEvent})})),this.show(),this.initialized=!0}destroySlot(){var e;this.hide(),null===(e=this.stickyBehaviour)||void 0===e||e.unsetSticky(),this.getGoogletagService().then((e=>{e.destroySlot(this.props.tagId),this.adNode.innerHTML=""})),this.initialized=!1}show(){var e,t,i;null===(e=this.adNode.parentElement)||void 0===e||null===(t=e.classList)||void 0===t||t.replace(O,T),null===(i=this.stickyBehaviour)||void 0===i||i.connectObservers()}hide(){var e,t,i;null===(e=this.adNode.parentElement)||void 0===e||null===(t=e.classList)||void 0===t||t.replace(T,O),null===(i=this.stickyBehaviour)||void 0===i||i.disconnectObservers()}refreshSlot(){this.getGoogletagService().then((e=>{e.refreshSlot(this.props.tagId)}))}}),window.opbox.component.register({prototypeName:"allegro.advertisement.slot.parallax",clientImplementationVersion:e},class extends f{constructor({services:e,props:t}){super(S(e,t,["offerId","erotic","sellerId"])),s(this,"adClipNode",void 0),s(this,"wrapperNode",void 0),s(this,"props",void 0),s(this,"slotSize",null),s(this,"adNode",void 0),s(this,"onEvent",(e=>{e.type===o.SlotEventType.ON_VIEW&&g(this.adNode,e.event.slot),e.type===o.SlotEventType.ON_RENDER&&(this.slot=e.event.slot,this.slotSize=e.event.size,this.adClipNode.classList.add("_d0a4b_JMju5"),this.scaleToFitContainer())})),s(this,"scaleToFitContainer",(()=>{var e;if(!this.slotSize)return this.adNode.style.transform="scale(1) perspective(0)",this.wrapperNode.style.height="0px",this.wrapperNode.style.overflow="hidden",void(this.adNode.style.position="static");const[t,i]=this.slotSize,s=(t+((null!==(e=this.wrapperNode.offsetWidth)&&void 0!==e?e:0)-t))/t,o=Math.floor(s*i);this.wrapperNode.style.height=o+"px",this.adNode.style.transform=`scale(${s}) perspective(0)`,this.adNode.style.position="fixed",this.wrapperNode.style.overflow="visible"})),this.props=t;const i=document.getElementById(t.tagId),r=document.getElementById(t.tagId+"-ad-clip"),n=document.getElementById(t.tagId+"-wrapper");if(!i||!r||!n)throw Error("Couldn't find the ad node");this.adNode=i,this.adClipNode=r,this.wrapperNode=n}onMount(){this.initialize(),window.addEventListener("resize",this.scaleToFitContainer)}onUnmount(){this.destroy(),window.removeEventListener("resize",this.scaleToFitContainer),this.wrapperNode.style.height="auto"}onUpdate(e){this.props=((e,{unitPath:t,responsiveMappings:i,categoryData:s,erotic:o,userTraits:r,offerId:l,sellerId:d})=>({type:n.PARALLAX,tagId:e,unitPath:t,responsiveMappings:i.map(p),erotic:o,categoryPath:a(s),userTraits:c(r),rawUserTraits:r,offerId:l,sellerId:d}))(this.props.tagId,e),this.refresh(!0)}initialize(){const{tagId:e,unitPath:t}=this.props;this.getGoogletagService().then((i=>{i.defineSlot({tagId:e,unitPath:t,size:v(this.props.responsiveMappings),slotConfigurationCallback:this.applySlotConfiguration,onEvent:this.onEvent})}))}destroy(){this.getGoogletagService().then((e=>{e.destroySlot(this.props.tagId)}))}}),window.opbox.component.register({prototypeName:"allegro.advertisement.slot.underPrice",clientImplementationVersion:e},class extends f{constructor({services:e,props:t}){super(S(e,t,["offerId","offerImage","offerPrice","offerTitle"])),s(this,"props",void 0),s(this,"slotSize",null),s(this,"adNode",void 0),s(this,"onEvent",(e=>{e.type===o.SlotEventType.ON_VIEW&&g(this.adNode,e.event.slot),e.type===o.SlotEventType.ON_RENDER&&(this.slotSize=e.event.size,this.slot=e.event.slot,this.scaleToFitContainer())})),s(this,"scaleToFitContainer",(()=>{var e;const{parentElement:t}=this.adNode;if(!t||!this.slotSize)return;const[i,s]=this.slotSize,o=(null!==(e=t.offsetWidth)&&void 0!==e?e:0)-i;if(o<0){const e=(i+o)/i,r=e*s;this.adNode.style.transform=`scale(${e})`,t.style.height=r+"px",t.style.alignItems="center"}else t.style.alignItems=""})),this.props=t;const i=document.getElementById(t.tagId);if(!i)throw Error("Couldn't find the ad node");this.adNode=i}onMount(){this.initialize(),window.addEventListener("resize",this.scaleToFitContainer)}onUnmount(){this.destroy(),window.removeEventListener("resize",this.scaleToFitContainer)}onUpdate(e){this.props=((e,{unitPath:t,responsiveMappings:i,alignment:s,userTraits:o,offerData:r})=>{var a,l,d;return{type:n.UNDER_PRICE,tagId:e,unitPath:t,responsiveMappings:i.map(p),alignment:s,userTraits:c(o),rawUserTraits:o,offerId:r.id,offerTitle:r.name,offerImage:null!==(a=null===(l=r.images[0])||void 0===l?void 0:l.url)&&void 0!==a?a:null,offerPrice:P(r.sellingMode),categoryPath:(d=r.breadcrumbs,d&&0!==d.length?d.map((e=>e.id)).filter((e=>e&&e.length<=20)).join("_"):"")}})(this.props.tagId,e),this.refresh()}initialize(){const{tagId:e,unitPath:t}=this.props;this.getGoogletagService().then((i=>{i.defineSlot({tagId:e,unitPath:t,size:v(this.props.responsiveMappings),slotConfigurationCallback:this.applySlotConfiguration,onEvent:this.onEvent})}))}destroy(){this.getGoogletagService().then((e=>{e.destroySlot(this.props.tagId)}))}}),window.opbox.component.register({prototypeName:"allegro.advertisement.slot.gdprMessage",clientImplementationVersion:e},class{constructor({services:e,props:t}){s(this,"services",void 0),s(this,"props",void 0),this.services=e,this.props=t}getGoogletagService(){return this.services.get(r)}onMount(){const{tagId:e,unitPath:t,responsiveMappings:i}=this.props;this.getGoogletagService().then((s=>{s.defineSlot({tagId:e,unitPath:t,size:v(i),slotConfigurationCallback:this.applySlotConfiguration})}))}applySlotConfiguration(e){const t=googletag.sizeMapping();this.props.responsiveMappings.forEach((({viewport:e,sizes:i})=>{t.addSize([e.width,e.height],i)})),e.defineSizeMapping(t.build())}onUnmount(){this.getGoogletagService().then((e=>{e.destroySlot(this.props.tagId)}))}})})();
//# sourceMappingURL=index.es6_3cf439e8.js.map