var e=[e=>{e.exports={SlotEventType:{ON_RENDER:0,ON_VIEW:1}}}],t={};function o(s){var n=t[s];if(void 0!==n)return n.exports;var a=t[s]={exports:{}};return e[s](a,a.exports,o),a.exports}o.d=(e,t)=>{for(var s in t)o.o(t,s)&&!o.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},o.o=(e,t)=>({}.hasOwnProperty.call(e,t));var s={};(()=>{o.d(s,{a:()=>g,b:()=>d});var e=o(0);let t=(e=>(e.GOOGLE="googleAdvertisingProducts",e))({});const n=()=>window.googletag.pubads(),a=({lang:e,currency:t})=>{googletag.cmd.push((()=>{n().setTargeting("lang",e),n().setTargeting("currency",t)}))},l=({isB2b:e})=>{const{baseDomain:t}=window.opbox.config;googletag.cmd.push((()=>{n().setTargeting("marketplaceType",((e,t)=>e.includes("business")||e.includes("allegro.pl")&&t?"b2b":"b2c")(t,e))}))};class i{constructor(){this.setUpPubAds=()=>{window.googletag.pubadsReady||(this.enableLazyLoad(),this.setIFrameConfig(),n().setForceSafeFrame(!0),n().enableSingleRequest(),n().collapseEmptyDivs(),window.googletag.enableServices())},this.enableLazyLoad=()=>{n().enableLazyLoad({fetchMarginPercent:200,renderMarginPercent:50,mobileScaling:2})},this.setIFrameConfig=()=>{n().setSafeFrameConfig({allowOverlayExpansion:!0,allowPushExpansion:!0,sandbox:!0})}}}class r{constructor(e){this.pubadsSlotInstance=null,this.renderStatus="unknown",this.defineSlot=()=>{const{tagId:e,size:t,unitPath:o,slotConfigurationCallback:s}=this.props;return this.pubadsSlotInstance=googletag.defineSlot(o,t,e).addService(n()),null==s||s(this.pubadsSlotInstance),this.pubadsSlotInstance},this.displaySlot=()=>{const{tagId:e}=this.props;googletag.display(e)},this.refreshSlot=()=>{this.pubadsSlotInstance&&n().refresh([this.pubadsSlotInstance])},this.props=e}onEvent(t){var o,s;null==(o=(s=this.props).onEvent)||o.call(s,t),this.pubadsSlotInstance&&t.type===e.SlotEventType.ON_RENDER&&(this.renderStatus=t.event.isEmpty?"empty":"filled")}}const d={lang:"pl-PL",currency:"PLN",contextB2b:{isB2b:!1,userPreferredView:"CONSUMER"}};class g{constructor(){this.pubadsConfigurationManager=new i,this.personalizationChecked=!1,this.allDefinedAdsAreReady=!1,this.definedSlots=[],this.defineSlot=e=>{const{unitPath:t}=e;t.length>0&&googletag.cmd.push((()=>{const t=new r(e);t.defineSlot(),this.definedSlots.push(t),this.debouncedDisplayAllSlots()}))},this.debouncedDisplayAllSlots=(({onComplete:e,waitForMs:t,limit:o})=>{let s,n=0;return(...a)=>{clearTimeout(s),n++,n>=o?e(...a):s=setTimeout((()=>e(...a)),t)}})({onComplete:()=>{this.allDefinedAdsAreReady=!0,this.displayAllSlots()},waitForMs:100,limit:document.querySelectorAll('[data-prototype-id^="allegro.advertisement.slot."] > [data-initially-visible="true"]').length}),this.displayAllSlots=()=>{this.personalizationChecked&&this.allDefinedAdsAreReady&&googletag.cmd.push((()=>{var e;this.pubadsConfigurationManager.setUpPubAds(),null==(e=this.definedSlots[this.definedSlots.length-1])||e.displaySlot()}))},this.displaySlot=e=>{googletag.cmd.push((()=>{const t=this.getSlotManager(e);null==t||t.displaySlot()}))},this.refreshSlot=e=>{setTimeout((()=>{googletag.cmd.push((()=>{const t=this.getSlotManager(e);null==t||t.refreshSlot()}))}),0)},this.getSlot=e=>{const t=this.getSlotManager(e);return t?t.pubadsSlotInstance:null},this.getSlotRenderStatus=e=>{const t=this.definedSlots.find((t=>t.props.tagId===e));return t?t.renderStatus:"unknown"},window.googletag=window.googletag||{},googletag.cmd=googletag.cmd||[],this.setAdsPersonalization(),googletag.cmd.push((()=>{n().addEventListener("slotRenderEnded",(t=>this.handleSlotEvent({type:e.SlotEventType.ON_RENDER,event:t}))),n().addEventListener("impressionViewable",(t=>this.handleSlotEvent({type:e.SlotEventType.ON_VIEW,event:t})))}))}async setAdsPersonalization(){const e=(e=>{const{cookie:t}=document;if(!t)return e?void 0:{};const o=t.split("; ").reduce(((e,t)=>{const o=t.split("="),s=decodeURIComponent(o[0]),n=decodeURIComponent(o[1]);return e[s]=n,e}),{});return e?o[e]:o})("_cmuid");await(async e=>{var t;const o=await(async()=>await window.opbox.preferences.get("rodoConsents"))();return!0===(null==o||null==(t=o.vendors)?void 0:t[e])})(t.GOOGLE)&&e?googletag.cmd.push((()=>{n().setPublisherProvidedId(e)})):googletag.cmd.push((()=>{n().setRequestNonPersonalizedAds(1)}));try{const{lang:e,currency:t,contextB2b:o}=await window.opbox.preferences.getMany(d);a({lang:e,currency:t}),l(o)}catch(o){const{lang:e,currency:t,contextB2b:s}=d;a({lang:e,currency:t}),l(s)}this.personalizationChecked=!0,this.displayAllSlots()}destroySlot(e){googletag.cmd.push((()=>{const t=this.getSlot(e);t&&googletag.destroySlots([t]),this.removeSlotManager(e)}))}getSlotManager(e){const t=this.definedSlots.find((t=>t.props.tagId===e));if(t&&t.pubadsSlotInstance)return t}removeSlotManager(e){this.definedSlots=this.definedSlots.filter((t=>t.props.tagId!==e))}handleSlotEvent(e){var t;null==(t=this.definedSlots.find((t=>e.event.slot===t.pubadsSlotInstance)))||t.onEvent(e)}}window.opbox.services.register({serviceName:"@allegro/opbox-googletag-service"},g)})();var n=s.a,a=s.b;export{n as GoogletagService,a as TARGETING_DEFAULTS};
//# sourceMappingURL=index.es6_82a194a2.js.map