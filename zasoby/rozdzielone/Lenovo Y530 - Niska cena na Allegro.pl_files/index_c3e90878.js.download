!function(){"use strict";var e,t={};function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function r(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}function i(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||r(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function u(e){var t=function(e,t){if("object"!==a(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==a(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return e+""}(e);return"symbol"===a(t)?t:t+""}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,u(r.key),r)}}function c(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}e=t,"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0});var l="other",d=function(e){if(e)return e.map((function(e){return{id:e.id,name:e.name,alias:e.alias}}))},f=function(e,t){return e?Object.assign({name:e},t?{value:t}:void 0):void 0};function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,u=[],s=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=o.call(n)).done)&&(u.push(r.value),u.length!==t);s=!0);}catch(e){c=!0,i=e}finally{try{if(!s&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return u}}(e,t)||r(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var y=["isAuthenticated","isInternal","orderId","offerId","purchaseId"],p=["1"],m="surveyQueuedEvents",h=Error("Failed to render survey"),b=function(){function e(t){var n=this,r=t.window,s=t.api,c=t.props;o(this,e),this.window=void 0,this.api=void 0,this.props=void 0,this.surveyRequested=void 0,this.metadata=void 0,this.surveyInitiationData=void 0,this.getSurveyInitiationData=function(e){var t=function(e){switch(e){case"desktop":case"tablet":return"web";case"phone":case"phone-iphone":case"phone-android":return"mweb";case"mobileapp-android":return"android";case"mobileapp-iphone":return"ios";default:return l}}(n.props.device);if(t!==l)return{channelName:t,userLocation:{url:n.window.location.toString(),categoryPath:d(n.props.categoryPath)},customParams:e}},this.requestSurvey=function(e){n.surveyRequested=!0;var t=sessionStorage.getItem(m),r=t?JSON.parse(t):void 0,o=e||r?[].concat(i(e||[]),i(r||[])):void 0,s=function(e,t){var n=t?{events:t}:void 0;return Object.assign(Object.assign({},e),n)}(n.props.customParams,o),c=function(e,t){var n=[];e&&Object.keys(e).includes("listingType")&&n.push(f("LISTING_VIEW",{listingType:e.listingType}));var r=t||[],o=t||n.length>0?{events:[].concat(i(r),n)}:void 0;return Object.assign(Object.assign({},e),o)}(s,o);n.surveyInitiationData=n.getSurveyInitiationData(c),sessionStorage.removeItem(m),n.surveyInitiationData&&n.api.fetchSurveyInitiationData(n.surveyInitiationData,n.props.originLang,n.props.forceLang).then((function(e){if(e&&200===e.status&&e.data){var t,r=null==(t=e.data.metadata)?void 0:t.language;n.metadata=e.data.metadata,n.showSurvey(e.data.surveyId,r,function(e,t){var n=Object.entries(t||{}).filter((function(e){var t=v(e,1)[0];return y.includes(t)})).map((function(e){var t=v(e,2),n=t[0],r=t[1],i=r;return"string"!=typeof r&&(i=JSON.stringify(r)),function(e,t,n){return(t=u(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},n,i)})).reduce((function(e,t){return Object.assign(Object.assign({},e),t)}),{}),r=(t||{}).events,i={};return r&&(i=r.filter((function(e){return null==e?void 0:e.value})).map((function(e){return e.value})).map((function(e){for(var t={},n=0,r=Object.entries(e||{});n<r.length;n++){var i=v(r[n],2),o=i[0],a=i[1];t[o]="string"==typeof a?a:JSON.stringify(a)}return Object.assign(Object.assign({},e),t)})).reduce((function(e,t){return"object"!==a(t)?{}:Object.assign(Object.assign({},e),t)}),{})),Object.assign(Object.assign(Object.assign({},e),n),i)}(n.metadata,c),e.data.showDelay,e.data.style)}}))},this.markPresented=function(e){p.includes(e)||n.surveyInitiationData&&n.api.markPresented(e,n.surveyInitiationData)},this.initSurvey=function(){n.window.document.hidden?n.window.document.addEventListener("visibilitychange",(function e(){"visible"!==document.visibilityState||n.surveyRequested||(n.requestSurvey(),n.window.document.removeEventListener("visibilitychange",e))})):n.requestSurvey()},this.showSurvey=function(e,t,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"MODAL";setTimeout((function(){var o;if(null===document.getElementById("ocb-modal")){var a=(o=n.window.location.host,"SIDEBAR"===i?function(e){switch(!0){case e.includes("allegro.cz"):case e.includes("allegro.sk"):return"/dotazniky/bocnipanel";case e.includes("allegro.hu"):return"/felmeresek/oldalso-iranyitopult";case e.includes("allegro.com"):return"/surveys/sidebar";default:return"/ankiety/sidebar"}}(o):function(e){switch(!0){case e.includes("allegro.cz"):return"/dotazniky/modalni";case e.includes("allegro.sk"):return"/dotazniky/modalny";case e.includes("allegro.hu"):return"/felmeresek/modalis";case e.includes("allegro.com"):return"/surveys/modal";default:return"/ankiety/modal"}}(o)),u="".concat(a,"/").concat(e),s=null;"string"==typeof t&&(s={lang:t}),n.metadata=r,n.window.opbox.page.render.fragment(Object.assign({pathname:u},s&&{additionalQueryParameters:s})).catch((function(){n.window.opbox.reportError(h)}))}}),1e3*Number(arguments.length>3&&void 0!==arguments[3]?arguments[3]:"0"))},this.sendEvent=function(e,t){var r=f(e,t),i=r?[r]:[];n.requestSurvey(i)},this.sendEvents=function(e){var t=e.map((function(e){var t=e.name,n=e.payloadValue;return f(t,n)})).filter((function(e){return void 0===e}));n.requestSurvey(t)},this.queueEvent=function(e,t){var n=f(e,t);sessionStorage.setItem(m,JSON.stringify([n]))},this.getMetadata=function(){return n.metadata},this.window=r,this.props=c,this.api=s,this.surveyRequested=!1,this.initSurvey()}return c(e,[{key:"getPublicApi",value:function(){return{showSurvey:this.showSurvey,sendEvent:this.sendEvent,sendEvents:this.sendEvents,queueEvent:this.queueEvent,markPresented:this.markPresented,getMetadata:this.getMetadata}}}]),e}(),g="application/vnd.allegro.internal.v1+json",w={headers:{Accept:g,"Content-Type":g},withCredentials:!0},S=c((function e(t){var n=this,r=t.window;o(this,e),this.window=void 0,this.retries=0,this.fetchSurveyInitiationData=function(e,t,r){var i=new URLSearchParams,o="/survey/search/byLocation";"boolean"==typeof t&&i.append("origin-lang",t.toString()),"string"==typeof r&&i.append("lang",r);var a=i.toString();return a&&(o+="?".concat(a)),n.window.opbox.edge.post(o,e,w).catch((function(e){n.window.opbox.reportError(e)}))},this.markPresented=function(e,t){return n.window.opbox.edge.post("/survey/".concat(e,"/presented/byLocation"),t,w).then((function(e){return n.retries=0,e})).catch((function(r){if(n.window.opbox.reportError(r),n.retries+=1,!(n.retries>3))return new Promise((function(e){setTimeout(e,300*n.retries)})).then((function(){return n.markPresented(e,t)}))}))},this.window=r})),j=function(e){try{return JSON.parse(window.document.querySelector('script[data-serialize-plugin-name="survey"][data-civ="005"]').textContent)}catch(e){return window.opbox.reportError(Error('Missing serialized props of plugin "survey", with civ "005"')),{}}}().surveyConfiguration;if(j&&j.enabled){var O=new S(window);window.opbox.plugin.register({name:"survey"},new b({window:window,api:O,props:j}).getPublicApi())}var I=window;for(var E in t)I[E]=t[E];t.__esModule&&Object.defineProperty(I,"__esModule",{value:!0})}();
//# sourceMappingURL=index_c3e90878.js.map