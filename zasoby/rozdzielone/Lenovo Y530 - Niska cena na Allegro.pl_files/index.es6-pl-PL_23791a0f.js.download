const e="mpof_5r",t="mpof_ki",s="meqh_en",i={closeOnEsc:!0,closeOnOverlay:!0},o=()=>{};window.opbox.component.register([{prototypeName:"allegro.modal",clientImplementationVersion:"6ff"},{prototypeName:"allegro.modal.withDelay",clientImplementationVersion:"6ff"}],class{constructor({baseNode:e,props:s,targetWindow:a=window,services:h}){this.showModalByAPI=(e=o)=>{this.visible||(this.onDismiss=e,this.showModal(),this.window.opbox.analytics.sendBoxInteractionEvent({contextNode:this.modalNode,label:"modalAPI",value:"open"}))},this.hideModalByAPI=()=>{this.visible&&(this.delegateHideModal(),this.window.opbox.analytics.sendBoxInteractionEvent({contextNode:this.modalNode,label:"modalAPI",value:"close"}))},this.handleHashChange=()=>{if(this.visible&&this.shouldHandleHash()&&!this.doesHashMatch(this.triggerHash))return this.hideModal(),void this.handleHashChangeAnalytics(this.actionTypeValue.close);!this.visible&&this.shouldHandleHash()&&this.doesHashMatch(this.triggerHash)&&(this.showModal(),this.handleHashChangeAnalytics(this.actionTypeValue.open))},this.onKeyDown=e=>{27===e.keyCode&&this.visible&&this.config.closeOnEsc&&(e.preventDefault(),this.window.opbox.analytics.sendBoxInteractionEvent({contextNode:this.baseNode,label:"modalClose_escKey"}),this.delegateHideModal())},this.delegateHideModal=()=>{this.shouldHandleHash()&&this.doesHashMatch(this.triggerHash)?this.simulateModalAsPage?this.pushBrowserHistory():this.replaceBrowserHistory():this.hideModal()},this.handleMouseDown=e=>{this.currentTargetNode=e.target},this.handleMouseUp=e=>{this.currentTargetNode!==e.target&&(this.currentTargetNode=null)},this.toggleVisibility=e=>{var t;const s=null==(t=this.contentNode)?void 0:t.contains(e.target),i=!this.window.document.contains(e.target);if(!s&&!i){if(e.stopPropagation(),e.preventDefault(),!this.config.closeOnOverlay)return;this.window.opbox.analytics.sendBoxInteractionEvent({contextNode:this.modalNode,label:"modalClose_overlay"});const t=null!==this.currentTargetNode;this.currentTargetNode=null,this.visible&&t?this.delegateHideModal():this.visible||this.showModal()}},this.setConfig=({closeOnEsc:e=i.closeOnEsc,closeOnOverlay:t=i.closeOnOverlay}=Object.assign({},i))=>{this.config=Object.assign(Object.assign({},this.config),{},{closeOnEsc:e,closeOnOverlay:t})},this.window=a,this.bodyNode=this.window.document.body,this.onDismiss=o,this.baseNode=e,this.modalTriggers=this.baseNode.querySelectorAll('[data-role="modal-trigger"]'),this.modalNode=this.baseNode.querySelector('[data-role="modal"]'),this.contentNode=this.baseNode.querySelector('[data-role="modal-content-container"]'),this.scrollContainer=this.baseNode.querySelector('[data-role="modal-body"]'),this.currentTargetNode=null,this.simulateModalAsPage=s.simulateModalAsPage,this.showOnlyOnceADay=s.showOnlyOnceADay,this.boxName=s.boxName,this.hashMatchStrategy=s.hashMatchStrategy,this.triggerHash=s.triggerLinkUrl,this.showInitially=s.showInitially,this.visibilityPreference=s.visibilityPreference,this.showDelay=s.showDelay,this.visible=!1,this.services=h,this.actionTypeValue={open:"open",close:"close"},this.visibilityClassNameList=s.disableAnimation?[t]:[t,"_72c72_6e-gY"],this.isModalInitiallyOpenWithHash=!1,this.config=Object.assign({},i)}getLocationHash(){return this.window.location.hash}getPreviousHash(){const{state:e}=this.window.history;return e instanceof Object&&e.previousHash||""}shouldHandleHash(){return"none"!==this.hashMatchStrategy}doesHashMatch(e){return"startsWith"===this.hashMatchStrategy?this.getLocationHash().startsWith(e):this.getLocationHash()===e}reportVisibility(){if(this.visibilityPreference){const{key:e,value:t}=this.visibilityPreference;this.window.opbox.preferences.set(e,t)}}showModal(){this.visible=!0,this.modalNode.classList.remove(e),this.modalNode.classList.add(...this.visibilityClassNameList),this.bodyNode.classList.add(s),this.window.opbox.boxViewsMarker.recursivelyMarkBoxAsVisible(this.contentNode),this.reportVisibility(),this.window.addEventListener("mousedown",this.handleMouseDown),this.window.addEventListener("mouseup",this.handleMouseUp)}hideModal(){this.visible=!1,this.isModalInitiallyOpenWithHash=!1,this.modalNode.classList.add(e),this.modalNode.classList.remove(...this.visibilityClassNameList),this.bodyNode.classList.remove(s),this.onDismiss(),this.onDismiss=o,this.config=Object.assign({},i),this.window.opbox.boxViewsMarker.recursivelyMarkBoxAsHidden(this.contentNode),this.services.get("opbox-modal-service").then((e=>e.broadcastDismiss(this.boxName))),this.window.removeEventListener("mousedown",this.handleMouseDown),this.window.removeEventListener("mouseup",this.handleMouseUp)}handleHashChangeAnalytics(e){this.window.opbox.analytics.sendBoxInteractionEvent({contextNode:this.modalNode,label:e===this.actionTypeValue.open?"modalOpen":"modalClose",value:"hashChange"})}dispatchHashChangeEvent(){if(this.window.HashChangeEvent)return void this.window.dispatchEvent(new this.window.HashChangeEvent("hashchange"));const e=this.window.document.createEvent("Event");e.initEvent("hashchange",!0,!0),this.window.dispatchEvent(e)}replaceBrowserHistory(){const{pathname:e,search:t}=this.window.location;this.window.history.replaceState(null,this.window.document.title,`${e}${t}`),this.isModalInitiallyOpenWithHash||this.window.history.back(),this.dispatchHashChangeEvent()}pushBrowserHistory(){const{pathname:e,search:t,hash:s}=this.window.location;this.window.history.pushState({previousHash:s},this.window.document.title,`${e}${t}${this.getPreviousHash()}`),this.dispatchHashChangeEvent()}attachListeners(){this.modalTriggers.forEach((e=>{e.addEventListener("click",this.toggleVisibility)})),this.window.addEventListener("keydown",this.onKeyDown),this.window.addEventListener("hashchange",this.handleHashChange)}setLastSeenDate(e){this.window.localStorage.setItem(this.boxName,e)}getLastSeenDate(){return this.window.localStorage.getItem(this.boxName)}showModalInitially(){if(this.shouldHandleHash()&&this.doesHashMatch(this.triggerHash)||this.showInitially){if(this.showOnlyOnceADay){const e=(()=>{const e=new Date;return`${e.getDate()}${e.getMonth()}${e.getYear()}`})();if(this.getLastSeenDate()===e)return;this.setLastSeenDate(e)}if(this.showDelay){const e=1e3*this.showDelay;return void setTimeout((()=>{this.displayModal()}),e)}this.displayModal()}}displayModal(){this.showModal(),this.isModalInitiallyOpenWithHash=!0}onMount(){this.attachListeners(),this.services.get("opbox-modal-service").then((e=>e.register({boxName:this.boxName,showModal:this.showModalByAPI,hideModal:this.hideModalByAPI,setConfig:this.setConfig}))),this.showModalInitially()}onUnmount(){this.modalTriggers.forEach((e=>{e.removeEventListener("click",this.toggleVisibility)})),this.window.removeEventListener("keydown",this.onKeyDown),this.window.removeEventListener("hashchange",this.handleHashChange)}});
//# sourceMappingURL=index.es6-pl-PL_23791a0f.js.map