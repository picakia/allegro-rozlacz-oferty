var t,e,i=[(t,e,i)=>{i.d(e,{a:()=>s,b:()=>a});const a={Agent:"Agent",Chatbot:"Chatbot",Client:"Client",System:"System"},s={Agent:a.Agent,Chatbot:a.Chatbot,None:""}},(t,e,i)=>{i.d(e,{a:()=>a});const a={Minimized:"Minimized",Normal:"Normal"}},(t,e,i)=>{i.d(e,{a:()=>o,b:()=>l,c:()=>n,d:()=>r});var a=i(8);const s=localStorage||{getItem:()=>null,setItem(){},removeItem(){},clear(){},key:()=>null,length:0},n=()=>null!==s.getItem(a.a),l=t=>{try{const e=s.getItem(a.a)||"";return JSON.parse(e).conversations[t]||{}}catch(e){return{}}},r=(t,e)=>{const i=l(t),n={conversations:{[t]:Object.assign(Object.assign({},i),e)}};s.setItem(a.a,JSON.stringify(n))},o=()=>s.removeItem(a.a)},(t,e,i)=>{i.d(e,{a:()=>a});const a={Dependent:"Dependent",Standalone:"Standalone",WebView:"WebView"}},(t,e,i)=>{i.d(e,{a:()=>c,b:()=>h});const a="MobileApp",s="Mweb",n=/Mobile|iP(hone|od|ad)|Android|BlackBerry|IEMobile|Kindle|NetFront|Silk-Accelerated|(hpw|web)OS|Fennec|Minimo|Opera M(obi|ini)|Blazer|Dolfin|Dolphin|Skyfire|Zune/gi,l=/allegro/i,r=/client-id/i,o=()=>{const{userAgent:t}=navigator,e=t.match(l),i=t.match(r);return e&&i?a:t.match(n)?s:"Other"},c=()=>o()===a,h=()=>o()===s},(t,e,i)=>{i.d(e,{a:()=>a});const a=new class{constructor(){this.listeners=[],this.memoizedStream=new Map}emit(t,e){this.memoizedStream.set(t,e),this.listeners.filter((e=>e.event===t)).forEach((t=>setTimeout((()=>t.subscriber(e)),0)))}subscribe(t,e){const i={event:t,subscriber:e};if(this.listeners=[...this.listeners,i],this.memoizedStream.has(t)){const e=this.memoizedStream.get(t);this.emit(t,e)}return{unsubscribe:this.unsubscribe.bind(this,i)}}unsubscribe(t){this.listeners=this.listeners.filter((e=>e!==t))}}},,(t,e,i)=>{function a(t,e){if(null==t)return{};var i,a,s=((t,e)=>{if(null==t)return{};var i,a,s={},n=Object.keys(t);for(a=0;a<n.length;a++)i=n[a],e.indexOf(i)>=0||(s[i]=t[i]);return s})(t,e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);for(a=0;a<n.length;a++)i=n[a],e.indexOf(i)>=0||{}.propertyIsEnumerable.call(t,i)&&(s[i]=t[i])}return s}i.d(e,{a:()=>a})},(t,e,i)=>{i.d(e,{a:()=>a});const a="chat.preferences"},(t,e,i)=>{i.d(e,{a:()=>n,b:()=>s,c:()=>a});const a=()=>{},s=()=>null,n=()=>Promise.resolve()},(t,e,i)=>{i.d(e,{a:()=>a});const a=t=>({timestamp:(new Date).setMilliseconds(0),value:t})},(t,e,i)=>{i.d(e,{a:()=>a});const a=t=>console.warn(t)},(t,e,i)=>{function a(){return"visible"===document.visibilityState}function s(t,e=!1){const i=()=>t(a());return window.addEventListener("visibilitychange",i),e&&i(),()=>window.removeEventListener("visibilitychange",i)}i.d(e,{a:()=>a,b:()=>s})},(t,e,i)=>{i.d(e,{a:()=>l,b:()=>a,c:()=>s,d:()=>n});const a="application/vnd.allegro.internal.v5+json",s=3e3,n=6e4,l=3e3}],a={};function s(t){var e=a[t];if(void 0!==e)return e.exports;var n=a[t]={exports:{}};return i[t](n,n.exports,s),n.exports}s.m=i,s.d=(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},s.f={},s.e=t=>Promise.all(Object.keys(s.f).reduce(((e,i)=>(s.f[i](t,e),e)),[])),s.u=t=>(({47:"ChatWindow",207:"EndChat",307:"initializeAppState",370:"Chat",438:"Survey",709:"getAgentsAvailability",764:"Tooltip",797:"ChatMinimized",869:"Sound",886:"getInitialConversation",975:"startNewChatSession"}[t]||t)+".es6-pl-PL_"+s.h().slice(0,8)+".js"),s.h=()=>"ca6c72f1",s.o=(t,e)=>({}.hasOwnProperty.call(t,e)),t={},e="@allegro/opbox-plugin-chat:",s.l=(i,a,n,l)=>{if(t[i])t[i].push(a);else{var r,o;if(void 0!==n)for(var c=document.getElementsByTagName("script"),h=0;h<c.length;h++){var d=c[h];if(d.getAttribute("src")==i||d.getAttribute("data-webpack")==e+n){r=d;break}}r||(o=!0,(r=document.createElement("script")).type="module",r.charset="utf-8",r.timeout=120,s.nc&&r.setAttribute("nonce",s.nc),r.setAttribute("data-webpack",e+n),r.src=i,0!==r.src.indexOf(window.location.origin+"/")&&(r.crossOrigin="anonymous")),t[i]=[a];var b=(e,a)=>{r.onerror=r.onload=null,clearTimeout(u);var s=t[i];if(delete t[i],r.parentNode&&r.parentNode.removeChild(r),s&&s.forEach((t=>t(a))),e)return e(a)},u=setTimeout(b.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=b.bind(null,r.onerror),r.onload=b.bind(null,r.onload),o&&document.head.appendChild(r)}},s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.p="https://assets.allegrostatic.com/sc-14778/",(()=>{var t={826:0};s.f.j=(e,i)=>{var a=s.o(t,e)?t[e]:void 0;if(0!==a)if(a)i.push(a[2]);else{var n=new Promise(((i,s)=>a=t[e]=[i,s]));i.push(a[2]=n);var l=s.p+s.u(e),r=Error();s.l(l,(i=>{if(s.o(t,e)&&(0!==(a=t[e])&&(t[e]=void 0),a)){var n=i&&("load"===i.type?"missing":i.type),l=i&&i.target&&i.target.src;r.message="Loading chunk "+e+" failed.\n("+n+": "+l+")",r.name="ChunkLoadError",r.type=n,r.request=l,a[1](r)}}),"chunk-"+e,e)}};var e=(e,i)=>{var a,n,[l,r,o]=i,c=0;if(l.some((e=>0!==t[e]))){for(a in r)s.o(r,a)&&(s.m[a]=r[a]);o&&o(s)}for(e&&e(i);c<l.length;c++)n=l[c],s.o(t,n)&&t[n]&&t[n][0](),t[n]=0},i=self.webpackJsonp_1bb0f=self.webpackJsonp_1bb0f||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})(),(()=>{var t=s(7),e=s(0),i=s(3);const a="chatPlugin",n=["chatConfiguration"],l=({config:t=[]})=>{const a=window.opbox.config.language,s=t.find((({chatAlias:t,chatInstance:e,conversationWith:i,restrictions:s})=>{if(!t||!e||!i)return!1;if(s){let t=!0;const{languages:e=[],urls:i=[]}=s,n=!!e.length,l=!!i.length;return n&&t&&(t=e.some((t=>t===a))),l&&t&&(t=i.some((({hash:t="",queryParams:e=[]})=>{const i=!!t,a=!!e.length,s=!i||(n=t,window.location.hash.replace("#","")===n.replace("#",""));var n;const l=!a||((t,e)=>{const i=new URLSearchParams(t),a=new URLSearchParams(e);return i.sort(),a.sort(),i.toString()===a.toString()})(window.location.search,e.reduce(((t,e)=>(t[e.key]=e.value,t)),{}));return s&&l}))),t}return!0}));return s?{chatAlias:s.chatAlias,chatInstance:s.chatInstance,conversationWith:s.conversationWith,tooltip:s.tooltip||null}:{chatAlias:"",chatInstance:i.a.Dependent,conversationWith:e.a.None,tooltip:null}};var r=s(1),o=s(13),c=s(9),h=s(12),d=s(10),b=s(2),u=s(11),g=s(4),p=s(5);const v=[/\/moje-allegro\/moje-konto\/centrum-wiadomosci\/wiadomosci(|\/.*)$/gi],A=(()=>{const e=(({pluginName:t,clientImplementationVersion:e})=>{try{return JSON.parse(window.document.querySelector(`script[data-serialize-plugin-name="${t}"][data-civ="${e}"]`).textContent)}catch(i){return window.opbox.reportError(Error(`Missing serialized props of plugin "${t}", with civ "${e}"`)),{}}})({pluginName:a,clientImplementationVersion:"d68"}),{chatConfiguration:i}=e,s=(0,t.a)(e,n);return Object.assign(Object.assign({},s),{},{chatConfiguration:l(i)})})(),m=new class{constructor(t){this.state=void 0,this.props=void 0,this.agentsAvailabilityCheckInterval=void 0,this.unsubscribeTabVisibilitySubscription=void 0,this.registeredFunctions=void 0,this.setState=t=>{this.state=Object.assign(Object.assign({},this.state),t)},this.loadComponent=(t,e)=>{s.e(370).then(s.bind(s,15)).then((({renderChat:i})=>i(t,e))),this.setState({loaded:!0})},this.props=t,this.state={loaded:!1,chatAgentsAvailable:!1,callbackAsapAgentsAvailable:!1,callbackScheduleAgentsAvailable:!1,callbackAlias:"",chatInProgress:!1,chatAlias:t.chatConfiguration.chatAlias||"",gmsServiceId:""},this.registeredFunctions={closeChatWindow:c.c,endChatSession:c.c,endCallbackSession:c.c,setChatStartedMode:c.c,startCallbackSession:c.c},this.subscribeEvents(),this.initialize()}async initialize(){const{chatInstance:t}=this.props.chatConfiguration;let e=null;if(!(0,g.a)()||!(()=>{const{pathname:t}=window.location;return v.some((e=>null!==t.match(e)))})()){if(this.isPluginInitialized()){const{getInitialConversation:t}=await s.e(886).then(s.bind(s,14));e=await t().catch((()=>null))}if(null!==e){this.state.chatInProgress=!0;const{initializeAppState:t}=await s.e(307).then(s.bind(s,16)),i=t(e,this.props.chatConfiguration);this.loadComponent(i,e),this.registeredFunctions.setChatStartedMode()}else(0,b.a)(),t===i.a.WebView?this.startNewChatSession():this.initializeStandaloneChat()}}subscribeEvents(){p.a.subscribe("startConversation",(t=>{this.updateChatAlias(t),this.startNewChatSession()})),p.a.subscribe("startNewWebViewConversation",(t=>{this.updateChatAlias(t),this.setState({chatInProgress:!1}),this.startNewChatSession()})),p.a.subscribe("closeWindow",(()=>{this.registeredFunctions.closeChatWindow(),this.setState({chatInProgress:!1})})),p.a.subscribe("disconnected",(()=>{this.registeredFunctions.endChatSession(),this.initializeStandaloneChat()}))}initializeStandaloneChat(){const{chatAlias:t,chatInstance:a,conversationWith:s,tooltip:n}=this.props.chatConfiguration,{callbackAlias:l,gmsServiceId:o,loaded:c}=this.state;a===i.a.Standalone&&(s===e.a.Agent&&this.startAgentsAvailabilityChecker({chatAlias:t,callbackAlias:l,gmsServiceId:o}),c?p.a.emit("updateAppState",{chatAlias:t,chatInstance:a,conversationWith:s,tooltip:n}):this.loadComponent({chatAlias:t,chatInstance:a,conversationWith:s,displayModeState:(0,d.a)(r.a.Minimized),tooltip:n}))}startNewChatSession(t,e){const{chatAlias:i,chatInProgress:a}=this.state;return a?((0,u.a)("Conversation already started."),Promise.resolve()):i?s.e(975).then(s.bind(s,17)).then((({startNewChatSession:i})=>i(this.props,this.state,this.setState,this.loadComponent,t,e))):((0,u.a)(`Conversation wasn't created. Chat alias "${i}" is incorrect.`),Promise.resolve())}updateAliases({callbackAlias:t=this.state.callbackAlias,chatAlias:e=this.state.chatAlias,gmsServiceId:i=this.state.gmsServiceId}){this.setState({callbackAlias:t||"",chatAlias:e||"",gmsServiceId:i||""})}updateAvailability({isCallbackAsapConsultantAvailable:t,isCallbackScheduleConsultantAvailable:e,isConsultantAvailable:i}){this.setState({chatAgentsAvailable:i,callbackScheduleAgentsAvailable:e,callbackAsapAgentsAvailable:t})}isPluginInitialized(){return!("chatConversationProbablyActive"in this.props&&!(0,b.c)())||this.props.chatConversationProbablyActive}startAgentsAvailabilityChecker(t){var e;this.updateAliases(t);const i=()=>{const t={isCallbackAsapConsultantAvailable:!1,isCallbackScheduleConsultantAvailable:!1,isConsultantAvailable:!1};this.updateAvailability(t),p.a.emit("agentsAvailability",t)};null==(e=this.unsubscribeTabVisibilitySubscription)||e.call(this),this.clearAgentsAvailabilityCheckInterval(),this.unsubscribeTabVisibilitySubscription=(0,h.b)((e=>{var a,s;e?this.agentsAvailabilityCheckInterval=(a=()=>this.checkAgentsAvailability(t).catch(i),s=o.a,a(),setInterval(a,s)):this.clearAgentsAvailabilityCheckInterval()}),!0)}clearAgentsAvailabilityCheckInterval(){const t=this.agentsAvailabilityCheckInterval;t&&(clearInterval(t),this.agentsAvailabilityCheckInterval=void 0)}async checkAgentsAvailability(t){if(!t.chatAlias&&!t.callbackAlias)throw Error("No callback and chat aliases.");return this.updateAliases(t),s.e(709).then(s.bind(s,18)).then((({getAgentsAvailability:e})=>{const{callbackAlias:i,chatAlias:a}=this.state;return e(Object.assign({callbackAlias:i,chatAlias:a},t))})).then((t=>{this.updateAvailability(t),p.a.emit("agentsAvailability",t)}))}registerFunctions(t){this.registeredFunctions=Object.assign(Object.assign({},this.registeredFunctions),t)}updateChatAlias(t=""){this.setState({chatAlias:t})}displayState(t){this.state.chatInProgress||t!==r.a.Normal?Object.values(r.a).includes(t)?p.a.emit("updateDisplayState",t):(0,u.a)("Passed state is incorrect."):(0,u.a)("You can't display chat if conversation isn't started.")}tooltip(t){p.a.emit("updateTooltipVisibility",!!t.visibility)}getPublicApi(){const t={updateChatAlias:this.updateChatAlias.bind(this),startNewChatSession:this.startNewChatSession.bind(this),startAgentsAvailabilityChecker:this.startAgentsAvailabilityChecker.bind(this),clearInterval:this.clearAgentsAvailabilityCheckInterval.bind(this),registerFunctions:this.registerFunctions.bind(this),displayState:this.displayState.bind(this),tooltip:this.tooltip.bind(this),eventBus:p.a};return Object.defineProperty(t,"chatAgentsAvailable",{get:()=>this.state.chatAgentsAvailable}),Object.defineProperty(t,"chatInProgress",{get:()=>this.state.chatInProgress}),Object.defineProperty(t,"callbackScheduleAgentsAvailable",{get:()=>this.state.callbackScheduleAgentsAvailable}),Object.defineProperty(t,"callbackAsapAgentsAvailable",{get:()=>this.state.callbackAsapAgentsAvailable}),Object.defineProperty(t,"callbackAlias",{get:()=>this.state.callbackAlias}),Object.defineProperty(t,"gmsServiceId",{get:()=>this.state.gmsServiceId}),Object.defineProperty(t,"startCallbackSession",{get:()=>this.registeredFunctions.startCallbackSession.bind(this)}),Object.defineProperty(t,"endCallbackSession",{get:()=>this.registeredFunctions.endCallbackSession.bind(this)}),t}}(A);window.opbox.plugin.register({name:a},m.getPublicApi())})();
//# sourceMappingURL=index.es6-pl-PL_ca6c72f1.js.map