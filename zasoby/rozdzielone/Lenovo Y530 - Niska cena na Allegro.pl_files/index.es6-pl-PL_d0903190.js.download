class e{constructor(e){this.downVoteLink=void 0,this.dymSection=void 0,this.changeQueryLink=void 0,this.dymSection=e.querySelector("[data-type]"),this.downVoteLink=e.querySelector('[data-role="downvote"]'),this.changeQueryLink=e.querySelector('[data-role="changeQuery"]')}getSuggestionData(){var e,t;return{userQuery:null==(e=this.dymSection)?void 0:e.dataset.query,suggestion:null==(t=this.dymSection)?void 0:t.dataset.suggestion}}sayThanks(){this.dymSection&&this.dymSection.firstElementChild&&this.dymSection.firstElementChild.classList.add(..."mj6k_n7 _5cb5b_gTWAw".split(" "))}getBoxType(){var e;return null==(e=this.dymSection)?void 0:e.dataset.type}getChangeQueryLinkType(){var e;return null==(e=this.changeQueryLink)?void 0:e.dataset.type}setSuggestionLink(e){this.changeQueryLink&&(this.changeQueryLink.href=e)}}class t{constructor(e,t){this.category=void 0,this.boxType=e,this.suggestionData=t,this.category="DidYouMean"}sendEvent(e){window.cm&&window.cm("send","event",{category:this.category,action:e,label:this.boxType,customParams:this.suggestionData})}}window.opbox.component.register({prototypeName:"allegro.didYouMean",clientImplementationVersion:"4dc"},class{constructor({baseNode:t}){this.ui=void 0,this.ui=new e(t)}onMount(){(()=>{const e=new URL(window.location.href);"que"===(e.searchParams.get("ref")||"")&&(e.searchParams.delete("ref"),window.history.replaceState(null,"",e.toString()))})();const e=this.ui.getBoxType(),i=this.ui.getChangeQueryLinkType();if(!this.ui.dymSection||!e||!i)return;const n=this.ui.getSuggestionData(),s=new t(e,n);s.sendEvent("show"),this.ui.downVoteLink&&this.ui.downVoteLink.addEventListener("click",(()=>{s.sendEvent("close"),this.ui.sayThanks()})),this.ui.changeQueryLink&&this.ui.changeQueryLink.addEventListener("click",(()=>{s.sendEvent(i)}))}onUpdate(e){if(!this.ui.dymSection)return;if(!e.query)return void(this.ui.dymSection.parentNode&&this.ui.dymSection.parentNode.removeChild(this.ui.dymSection));const t=(({didYouMean:e,alternatives:t})=>e&&e.value?{phrase:e.value,ref:"dym"}:t&&t.length>0?{phrase:t[0].phrase,ref:"alt"}:null)(e);if(t&&e.pageUrl){const i=((e,t,i)=>{const n=new URL(e);return n.searchParams.set("string",t),i?n.searchParams.set("ref",i):n.searchParams.delete("ref"),n.searchParams.delete("p"),n.searchParams.delete("prevPhrase"),`${n.pathname}${n.search.replaceAll("+","%20")}`})(e.pageUrl,t.phrase,t.ref);this.ui.setSuggestionLink(i)}}});
//# sourceMappingURL=index.es6-pl-PL_d0903190.js.map