var e={d(t,s){for(var o in s)e.o(s,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:s[o]})},o(e,t){return{}.hasOwnProperty.call(e,t)},r(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{arrowIcon:()=>Ee,emptyText:()=>oe,errorText:()=>re,guestContentWrapper:()=>ie,guestText:()=>ae,guestTextPrimary:()=>ne,inbox:()=>J,inboxLoginButton:()=>K,message:()=>X,messageClicked:()=>ue,messageDisplayed:()=>ge,messageGroup:()=>Le,messageGroupContent:()=>Se,messageGroupContentInvisible:()=>Ae,messageGroupContentVisible:()=>Te,messageGroupHeader:()=>Me,messageGroupToggle:()=>De,messageGroupToggleOpen:()=>qe,messageIcon:()=>he,messageLink:()=>ee,messageMenuAction:()=>xe,messageMenuActionLink:()=>ke,messageMenuActions:()=>je,messageMenuDropdown:()=>fe,messageMenuDropdownContent:()=>ye,messageMenuDropdownContentContainer:()=>be,messageMenuDropdownOpen:()=>$e,messageMenuDropdownToggle:()=>we,messageMenuDropdownToggleActive:()=>ve,messageNew:()=>de,messageText:()=>se,messageTime:()=>pe,messages:()=>Q,registerButton:()=>le,right9px:()=>_e,spinner:()=>me,spinnerWrapper:()=>ce,text:()=>te});const s="m0qj_5r",o="m911_5r",n="mefy_5r",a="mnyp_5r",r="mdwl_5r",i="mjyo_6x",l="mgmw_3z",c="mgmw_wo",m="msts_pt",g="msts_n7",d="mqen_m6",u="mpof_5r",h="mpof_ki",p="mpof_z0",_="m389_6m",f="mx4z_5x",w="mp0t_0a",v="mgn2_14",b="mse2_40",y="mqu1_21",$="mp4t_16",j="mp4t_0",x="mryx_16",k="mryx_0",L="munh_0",M="m3h2_0",D="meqh_en",E="mg9e_24",q="mg9e_0",A="mj7a_24",S="mj7a_0",T="mh36_16",z="mh36_0",C="mvrt_16",N="mvrt_0",I="mp7g_f6",O="mp7g_oh",G="mzmg_6m",P="mj9z_5r",B="mhd5_0m",R="mli8_k4",U="mtsp_ib",V="m9vn_d2",Z="msa3_z4",Y="m7er_k4",H="l1fas",W="l1v1s",F="i1vy1",J=p+" "+Y+" _51ce4_VTLZD",K=v+" "+w+" m9qz_yp "+O+" "+b+" mqu1_40 "+U+" "+R+" "+M+" "+L+" "+o+" "+n+" "+a+" "+r+" msbw_2 mldj_2 mtag_2 mm2b_2 mqvr_2 "+Z+" "+d+" "+D+" "+s+" "+T+" "+C+" "+q+" "+S+" mjir_sv m2ha_2 m8qd_qh mjt1_n2 bhsw2 mgmw_9u msts_enp mrmn_qo mrhf_u8 m31c_kb m0ux_fp b1rxz "+$+" "+x+" mpof_vs mupj_5k "+i+" mjru_k4 _51ce4_rbfkL",Q=f+" mr3m_1 "+Y+" "+j+" "+M+" "+k+" "+L+" "+q+" "+N+" "+S+" "+z+" mdwt_56 _51ce4_A7Bbf",X=O+" "+p+" "+j+" "+M+" "+k+" "+L+" "+q+" "+N+" "+S+" "+z+" "+m+" _51ce4_5vNw-",ee=h+" mli2_1 "+P+" m7f5_5x m389_5x _51ce4_FwY5J",te=v+" "+w+" "+y+" "+c+" "+R+" "+j+" "+M+" "+k+" "+L+" _51ce4_uA5pp",se=v+" "+w+" "+y+" "+c+" "+R+" "+j+" "+M+" "+k+" "+L+" _51ce4_1UBeA",oe=G+" "+l+" "+E+" "+A,ne=c+" "+R+" mp0t_ji m9qz_yo "+L+" "+M+" mqu1_1j mgn2_16 mgn2_17_s "+$+" "+x,ae=l,re="m7er_56 msts_4u "+f+" mg9e_16 "+C+" mj7a_16 "+T+" "+$,ie=G+" "+E+" "+A,le=v+" "+w+" "+c+" "+y+" "+P+" "+R+" "+d+" "+H,ce=h+" m7f5_6m "+_+" mse2_k4",me=p+" "+D+" "+b+" mg9e_4 mvrt_4 mj7a_4 mh36_4 "+i+" m7er_40 kbcjb mp4t_24 m3h2_24 mryx_24 munh_24",ge="_51ce4_iW3Pk",de="_51ce4_N3Ssy",ue="_51ce4_46Ng4",he=b+" "+i+" "+D+" "+Z+" "+B+" "+F+" "+q+" "+N+" "+S+" "+z+" mli2_0 _51ce4_ADzjt",pe="mp4t_4 "+l+" "+w+" mgn2_12 mqu1_16 "+R+" "+h+" "+_+" _51ce4_drqyY",_e="_51ce4_PhQlk",fe=I+" "+d+" m9tr_5r "+_e+" _51ce4_NA571",we=v+" "+w+" "+c+" "+y+" "+P+" "+R+" "+d+" "+H+" "+q+" "+N+" "+S+" "+z+" "+o+" "+n+" "+a+" "+r+" "+Z+" "+s+" "+g+" "+W+" "+V+" m9vn_gl_m _51ce4_7wADt",ve=V,be=O,ye=I+" "+u+" "+i+" mjb5_w6 "+q+" "+N+" "+S+" "+z+" "+m+" mx7m_1 m911_co mefy_co mnyp_co mdwl_co mlkp_ag mnjl_0 _51ce4_Gw4oG",$e="_51ce4_ndoSo",je=w+" "+v+" "+y+" "+c+" "+R+" mb54_5r "+Y+" "+G+" "+T+" "+C+" _51ce4_JSMVe",xe=k,ke=v+" "+w+" "+c+" "+y+" "+P+" "+R+" "+d+" "+H+" "+q+" "+N+" "+S+" "+z+" "+o+" "+n+" "+a+" "+r+" "+Z+" "+s+" "+g+" "+W+" "+U,Le="_51ce4_YfXa-",Me=O+" _51ce4_t-4FR",De=I+" "+d+" "+_e+" _51ce4_ejYvH",Ee=i+" "+D+" "+Z+" "+B+" "+F+" "+q+" "+N+" "+S+" "+z+" mse2_24 _51ce4_qZe6-",qe="_51ce4_7T2YN",Ae=u,Se=u+" msts_r0 _51ce4_rlizB",Te=p,ze={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#x27;"},Ce=/<|>|&|"|'/g,Ne=/"|'/g,Ie=RegExp(Array.from("javascript:",(e=>e+"[\\n\\r\\t]*")).join(""),"ig"),Oe=e=>ze[e],Ge=e=>e.replace(Ne,Oe).replace(Ie,"");class Pe{constructor(e,t){this.$=e[0];for(let s=0;s<t.length;s++){const o=t[s];if(Array.isArray(o))for(let e=0;e<o.length;e++)this.$esc(o[e]);else this.$esc(o);this.$+=e[s+1]}}$esc(e){this.$+=e instanceof Pe?e.$:(e+"").replace(Ce,Oe)}toString(){return this.$}}const Be=e=>new Pe([e+""],[]),Re=e=>new Pe([Ge(e+"")],[]),Ue=(e,...t)=>new Pe(e,t);let Ve="pl-PL";const Ze={"pl-PL":{delete:[["",["Usuń wiadomość"]]],"delete-thread":[["",["Usuń cały wątek"]]],"more-than-month":[["",["ponad miesiąc temu"]]],day:[["",["{{days}} dzień temu","{{days}} dni temu","{{days}} dni temu"]]],"hour-short":[["",["{{hours}} godz. temu","{{hours}} godz. temu","{{hours}} godz. temu"]]],"minute-short":[["",["{{minutes}} min. temu","{{minutes}} min. temu","{{minutes}} min. temu"]]],sent:[["",["Wysłane"]]],category:[["",["Kategoria"]]],"expand-thread":[["",["Rozwiń wątek"]]],"expand-menu":[["",["Rozwiń menu"]]],"manage-message":[["",["Zarządzaj tą wiadomością"]]],"loading-messages-failed":[["",["Nie mogliśmy wyświetlić Twoich powiadomień."]]],login:[["",["Zaloguj się"]]],register:[["",["Zarejestruj się"]]],"log-in-heading":[["",["Zaloguj się i bądź na bieżąco"]]],"log-in-to-show-messages":[["",["Tutaj znajdziesz powiadomienia o okazjach <br/>i informacje związane z Twoimi działaniami <br/>na koncie Allegro."]]],"dont-have-account":[["",["Nie masz konta?"]]],"no-new-messages":[["",["Nie masz żadnych <br>nowych powiadomień."]]],"show-messages":[["",["Pokaż wiadomości"]]],"offer-image":[["",["Zdjęcie oferty"]]]}},Ye=/({{[^}]+}}|{%[^%}]+%})/g,He=/({{[^}]+}})/g,We=/({%[^%}]+%})/g,Fe=/({{\s*|\s*}}|{%\s*|\s*%})/g,Je={"pl-PL":e=>1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2};function Ke(e,t=""){if("string"==typeof e)throw Error("Translation has to be an array");return e.find((e=>e[0]===t))[1]}const Qe=(e,t,s)=>{const o=Ze[Ve][e];if(!o)throw Error(`Missing translation for lang "${Ve}" and key "${e}"`);return t?((e,t,s)=>{let o=Ke(e,t.context);return parseInt(t.count,10)>=0?o=((e,t)=>{const s=Je[Ve](t);return"boolean"!=typeof s?e[s]:e[s?1:0]})(o,t.count):[o]=o,((e,t,s)=>{if(s){let s=0;return e.split(Ye).map((o=>{if(o.match(We)){const n=t.formatters[s];if(n)return s+=1,n(o.replace(Fe,""));throw Error(`Missing translation formatter for "${e}"`)}return o.match(He)?t[o.replace(Fe,"")]:o}))}const o=e.match(Ye);let n=0;return o?o.reduce(((s,o)=>{const a=o.replace(Fe,"");if(o.match(We)){const r=t.formatters[n];if(r)return n+=1,s.replace(o,r(a));throw Error(`Missing translation formatter for "${e}"`)}return o.match(He)?s.replace(o,t[a]):s}),e):e})(o,t,s)})(o,t,s):Ke(o)[0]},Xe=(et=Object.assign({},t),(...e)=>e.map((e=>et[e]||e)).join(" "));var et;let tt,st,ot,nt,at,rt,it,lt,ct,mt,gt,dt=e=>e;const ut=(ht=new Date,e=>(e=>{if(e>=2592e3)return Qe("more-than-month");if(e>=86400){const t=Math.floor(e/86400);return Qe("day",{days:t,count:t})}if(e>=3600){const t=Math.floor(e/3600);return Qe("hour-short",{hours:t,count:t})}const t=Math.max(1,Math.floor(e/60));return Qe("minute-short",{minutes:t,count:t})})(Math.floor((ht.getTime()-e.getTime())/1e3)));var ht;function pt({svg:e,className:t=he,alt:s=Qe("category"),width:o="100%",height:n="100%"}){return Ue(st||(st=dt`<img class="${0}" src="${0}" alt="${0}" width="${0}" height="${0}" />`),t,e,s,o,n)}const _t=pt({className:Ee,svg:"https://a.allegroimg.com/original/3424ea/a70a9cfd4ee59ddb6d4fc30364c7/action-common-arrowhead-c3c511fba9",alt:Qe("expand-thread")}),ft=pt({className:Ee,svg:"https://a.allegroimg.com/original/345306/13b7a0e047fd8735a283a540f5e7/action-common-three-dots-8d6d31cbb0",alt:Qe("expand-menu")}),wt=pt({className:"",svg:"https://a.allegroimg.com/original/1814f0/f889a32345a58172222bef9df297.svg",alt:Qe("log-in-heading"),width:"112",height:"112"});function vt({text:e,image:{svg:t},status:s,createdAt:o,tinkerbellId:n,groupId:a},r=!1){const i=Xe("message","message"+(s.charAt(0)+s.slice(1).toLowerCase()));return Ue(rt||(rt=dt`<li class="${0}" data-role="message">${0} ${0}</li>`),i,((e,t=!1,s=null)=>Ue(nt||(nt=dt`<div class="${0}" data-role="message-actions-dropdown"><button type="button" data-role="message-dropdown" aria-label="${0}" class="${0}">${0}</button><div class="${0}"><div class="${0}">${0}</div></div></div>`),fe,Qe("manage-message"),we,ft,be,ye,((e,t,s)=>{const[o,n,a]=e?["action-delete-group",Qe("delete-thread"),t]:["action-delete",Qe("delete"),s];return Ue(ot||(ot=dt`<ul class="${0}"><li class="${0}"><button type="button" class="${0}" data-role="${0}" data-id-to-delete="${0}">${0}</button></li></ul>`),je,xe,ke,o,a,n)})(t,s,e)))(n,r,a),((e,t,s,o)=>Ue(at||(at=dt`<a data-role="message-link" href="${0}" class="${0}" data-analytics-clickable data-analytics-click-value="${0}">${0}<span><span class="${0}">${0}</span>${0}</span></a>`),"/inbox/redirect/id/"+t,ee,s,pt({svg:o}),se,s,Be((e=>{const t=new Date(e),s=t.toLocaleDateString(),o=ut(t);return Ue(tt||(tt=dt`<time class="${0}" datetime="${0}" aria-label="${0} ${0}">${0}</time>`),pe,s,Qe("sent"),o,o)})(e))))(o,n,e,t))}const bt=e=>vt(e,!1);function yt(e){if(1===e.length)return bt(e[0]);const[t,...s]=e,o=vt(t,!0),n=s.map(bt).join(""),a=Ue(it||(it=dt`<div class="${0}" data-role="message-group-toggle">${0}</div>`),De,_t);return Ue(lt||(lt=dt`<li class="${0}"><ol class="${0}">${0} ${0}</ol><ol data-role="message-group-content" class="${0}">${0}</ol></li>`),Le,Me,Be(o),Be(a),Se,Be(n))}function $t(e){return"group_"+e}function jt({className:e=ae,content:t}){return Ue(mt||(mt=dt`<p class="${0} ${0}">${0}</p>`),e,te,Be(t))}function xt(){const e=Qe("no-new-messages");return jt({className:oe,content:e})}function kt({loginUrl:e,registerUrl:t}){return Ue(gt||(gt=dt`<div class="${0}">${0}<p class="${0}">${0}</p>${0}<a href="${0}" class="${0}" rel="nofollow" data-role="login-button">${0}</a>${0}</div>`),ie,wt,ne,Qe("log-in-heading"),jt({content:Qe("log-in-to-show-messages")}),Re(e),K,Qe("login"),jt({content:`${Qe("dont-have-account")} <a href="${Re(t)}" class="${le}" rel="nofollow" data-analytics-clickable data-role="register-button">${Qe("register")}</a>`}))}const Lt="click";class Mt{constructor(e,t){this.loginButton=void 0,this.registerButton=void 0,this.path=void 0,this.loginButton=e.querySelector('[data-role="login-button"]'),this.registerButton=e.querySelector('[data-role="register-button"]'),this.path=t}mount(){this.loginButton&&this.loginButton.addEventListener(Lt,this),this.registerButton&&this.registerButton.addEventListener(Lt,this)}handleEvent(e){e.type===Lt&&((e,t)=>{e.preventDefault();const{target:s}=e;window.location.href=((e,t)=>`${e}?origin_url=${encodeURIComponent(""+(t||"/"))}`)(s.getAttribute("href"),t)})(e,this.path)}}const Dt="inViewport",Et='button[data-role="message-dropdown"]',qt='[data-role="message-actions-dropdown"]',At='[data-role="message-group-content"]',St='[data-role="message-group-toggle"]',Tt='[data-role="message"]',zt="."+Le;class Ct{constructor(e,t,s,o,n){var a=this;this.content=void 0,this.loadData=async()=>{const e=await a.api.getMessages(),t=(({messages:e})=>e.length>0?(e=>{const t=(e=>{const t=e.reduce(((e,t)=>{const s=e,o=t.groupId||t.tinkerbellId;return(s[$t(o)]||(s[$t(o)]=[])).push(t),s}),{});return Object.values(t)})(e).map(yt).join("");return Ue(ct||(ct=dt`<ul class="${0}" data-role="message-list">${0}</ul>`),Q,Be(t))})(e):xt())(e.data);return{messages:e,content:t}},this.onOpen=()=>{this.root.removeEventListener(Dt,this.onOpen),this.loadData().then(this.onResponse).catch(this.onError)},this.onResponse=({messages:{data:e},content:t})=>{this.setContent(t),this.setupListeners(),this.attachAnalytics(),this.handleDisplayed(e)},this.onError=({status:e})=>{const t=401===e?kt(this.props):(()=>{const e=Qe("loading-messages-failed");return jt({className:re,content:e})})();this.setContent(t)},this.setContent=e=>{this.content.innerHTML=e},this.handleDisplayed=({messages:e})=>{this.services&&this.services.get("opbox-notification-service").then((e=>{e.reset("inboxes")}));const t=e.filter((e=>"CLICKED"!==e.status));t.length>0&&this.api.updateStatusToDisplayed(t.map((e=>e.tinkerbellId)))},this.setupListeners=()=>{this.root.querySelectorAll(St).forEach((e=>e.addEventListener("click",this.toggleGroupVisibility))),this.root.querySelectorAll(Et).forEach((e=>e.addEventListener("click",this.toggleDeleteMessageDropdown))),this.root.querySelectorAll('[data-role="action-delete"]').forEach((e=>e.addEventListener("click",this.singleMessageDeleteListener(e.dataset.idToDelete)))),this.root.querySelectorAll('[data-role="action-delete-group"]').forEach((e=>e.addEventListener("click",this.groupMessageDeleteListener(e.dataset.idToDelete))))},this.toggleDeleteMessageDropdown=e=>{e.preventDefault();const t=e.currentTarget.parentElement.parentElement.querySelector(qt),s=t.classList.contains($e);this.root.querySelectorAll(qt).forEach(this.hideActionsDropdown),s||(t.classList.add($e),t.querySelector(Et).classList.add(ve))},this.toggleGroupVisibility=e=>{e.preventDefault();const t=e.currentTarget,s=t.parentElement;if(s){t.classList.toggle(qe);const e=s.parentElement.querySelector(At);e.classList.toggle(Te),e.classList.toggle(Ae)}},this.window=e,this.api=t,this.root=s,this.services=o,this.props=n,this.window=e,this.api=t,this.root=s,this.content=s.querySelector('[data-role="inbox"]'),this.services=o,this.props=n}mount(){const{isAuthenticated:e,isAnonymised:t}=this.props,s=null!==(e=>{const t=document.cookie.split(/;\s*/);for(let s=t.length-1;s>=0;s-=1){const[e,o]=t[s].split("=").map((e=>decodeURIComponent(e)));if("userIdentity"===e)return o}return null})();e||t&&s?this.root.addEventListener(Dt,this.onOpen):(this.setContent(kt(this.props)),new Mt(this.root,this.window.location).mount())}groupMessageDeleteListener(e){return t=>{t.stopPropagation(),this.api.deleteGroup(e),this.deleteMessageListItem(t.target.closest(zt)),this.window.opbox.analytics.sendClickEvent({contextNode:this.root,label:"deleteMessageGroup",value:e})}}deleteMessageListItem(e){e.remove(),this.root.querySelectorAll(Tt).length||(this.content.innerHTML=xt())}singleMessageDeleteListener(e){return t=>{t.stopPropagation(),this.api.delete(e),this.deleteSingleMessage(t.target.closest(Tt)),this.window.opbox.analytics.sendClickEvent({contextNode:this.root,label:"deleteSingleMessage",value:e})}}deleteSingleMessage(e){const t=e.parentNode,s=t.matches(At),o=1===t.childElementCount;s&&o&&this.removeGroupToggleControls(t),this.deleteMessageListItem(e)}removeGroupToggleControls(e){const t=e.parentNode.querySelector(St);e.remove(),t.remove()}hideActionsDropdown(e){e.classList.remove($e),e.querySelector(Et).classList.remove(ve)}attachAnalytics(){const e=this.root.querySelector('[data-role="inbox"]');this.root.querySelectorAll('[data-role="message"]').forEach((e=>{e.addEventListener("click",(e=>{e.stopPropagation(),this.window.opbox.analytics.sendClickEvent({contextNode:e.target,label:"notificationClicked"})}))})),e&&e.addEventListener("click",(e=>{e.stopPropagation()}))}}const Nt="/inbox/messages",It={withCredentials:!0,headers:{Accept:"application/json","Content-type":"application/json"}},Ot=(Object.assign(Object.assign({},It),{},{headers:{Accept:"application/vnd.allegro.internal.v1+json","Content-type":"application/vnd.allegro.internal.v1+json"}}),Object.assign(Object.assign({},It),{},{headers:Object.assign(Object.assign({},It.headers),{},{"Content-type":"application/vnd.allegro.public.v2+json"})}));class Gt{constructor(e){this.edge=void 0;const{opbox:{edge:t}}=e;this.edge=t}getMessages(){return this.edge.get(Nt,It)}updateStatusToDisplayed(e){const t={tinkerbellIdEvents:e.map((e=>({tinkerbellId:e})))};this.edge.post("/inbox/events/displayed",t,Ot)}delete(e){this.edge.delete(`${Nt}/${e}`,It)}deleteGroup(e){this.edge.delete("/inbox/messages/group/"+e,It)}}window.opbox.component.register({prototypeName:"allegro.user.inbox",clientImplementationVersion:"e07"},class{constructor({baseNode:e,services:t,props:s}){this.inbox=void 0,this.inbox=new Ct(window,new Gt(window),e,t,s)}onMount(){this.inbox.mount()}});
//# sourceMappingURL=index.es6-pl-PL_7146b194.js.map